{
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "Azure Inventory of Record",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "workbook",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "workbookSourceId": {
      "type": "string",
      "defaultValue": "azure monitor",
      "metadata": {
        "description": "The id of resource instance to which the workbook will be associated"
      }
    },
    "workbookId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    }
  },
  "resources": [
    {
      "name": "[parameters('workbookId')]",
      "type": "microsoft.insights/workbooks",
      "location": "[resourceGroup().location]",
      "apiVersion": "2022-04-01",
      "dependsOn": [],
      "kind": "shared",
      "properties": {
        "displayName": "[parameters('workbookDisplayName')]",
        "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"a36f0b3d-8826-4bec-95a9-70ec6cb77713\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscriptions\",\"type\":6,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::1\",\"value::all\"],\"includeAll\":true}},{\"id\":\"7b9badee-0be3-4b38-b532-b2657d0f5b87\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Help\",\"label\":\"Show Help\",\"type\":10,\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[]},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n { \\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true },\\r\\n { \\\"value\\\": \\\"Change Log\\\", \\\"label\\\": \\\"Change Log\\\"}\\r\\n]\",\"value\":\"Yes\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 8\"},{\"type\":1,\"content\":{\"json\":\"## Azure Inventory Workbook\\r\\nAdapted from \\\"Azure Resource Inventory\\\" v2.0.2 by scautomation on github.\\r\\nFind the original source here: https://github.com/scautomation/Azure-Inventory-Workbook\\r\\n\\r\\n\\r\\n \\r\\n\\r\\n\\r\\n\\r\\n\",\"style\":\"upsell\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Change Log\"},\"name\":\"text - Change Log\"},{\"type\":1,\"content\":{\"json\":\"\\t- This workbook relies on Azure Resource Graph. You need reader access to all resources you wish to see in this workbook.\\r\\n\\r\\n\\t- comment out \\\"| where type !has \\\"Not Translated\\\" \\\" from the query to see if your particular resource shows up.\\r\\n\",\"style\":\"success\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - Help file\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"f321b3dd-4d96-4aa7-ac57-5ad8ce236a48\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Overview\",\"subTarget\":\"overview\",\"style\":\"link\"},{\"id\":\"e79a9ba1-8aca-4e4a-9df7-83123cae1627\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Compute\",\"subTarget\":\"compute\",\"preText\":\"IaaS\",\"style\":\"link\"},{\"id\":\"ed3b708b-7054-424d-b32b-49451e04d36b\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"PaaS\",\"subTarget\":\"paas\",\"style\":\"link\"},{\"id\":\"9bd4447c-8cac-4e8a-9f9b-bbcc99209b13\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Networking\",\"subTarget\":\"network\",\"style\":\"link\"},{\"id\":\"8192cd42-be72-4d18-b234-9e9fef4418dd\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Monitoring & Security\",\"subTarget\":\"monitor\",\"style\":\"link\"},{\"id\":\"1c2b6655-5c72-47bf-b4c6-9ea2665c07ef\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Tagged Resources\",\"subTarget\":\"tags\",\"style\":\"link\"},{\"id\":\"284d9e1f-d3f9-477e-8fac-0fad54c0b392\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Untagged Resources\",\"subTarget\":\"notag\",\"style\":\"link\"},{\"id\":\"e4129241-70fc-4f13-8a19-481bba5ca6d2\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"App Services\",\"subTarget\":\"apps\",\"style\":\"link\"},{\"id\":\"d9efca74-1eed-4257-b0de-be21a52ac39f\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Change Analysis\",\"subTarget\":\"changes\",\"style\":\"link\"},{\"id\":\"af73535e-bd13-4bff-a074-8f8b2a71b616\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Sensitive Operations\",\"subTarget\":\"sensitiveops\",\"style\":\"link\"},{\"id\":\"53974ff4-5267-4a5c-98b2-2069184ddeb9\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Orphaned Resources\",\"subTarget\":\"orphans\",\"style\":\"link\"},{\"id\":\"f653ab9f-3385-41c2-bc06-234f17176f8c\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Intune\",\"subTarget\":\"intune\",\"style\":\"link\"}]},\"name\":\"links - 6\",\"styleSettings\":{\"padding\":\"0 0 20px 0\"}},{\"type\":1,\"content\":{\"json\":\"## NoShow - Begin Overview\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow Overview\"},{\"type\":1,\"content\":{\"json\":\"# Overview Azure Resources\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"overview\"},\"name\":\"text - Title\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Resources | summarize count(type)\",\"size\":4,\"title\":\"Count of All Resources\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"tiles\",\"sortBy\":[],\"tileSettings\":{\"titleContent\":{\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"count_type\",\"formatter\":12,\"formatOptions\":{\"showIcon\":true}},\"showBorder\":true,\"sortOrderField\":2}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"overview\"},\"name\":\"query - Overview Count\"},{\"type\":1,\"content\":{\"json\":\"## Subscriptions and Resource Groups\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"overview\"},\"name\":\"text - Subscriptions text\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resourcecontainers \\r\\n| where type has \\\"microsoft.resources/subscriptions/resourcegroups\\\"\\r\\n| summarize Count=count(type) by type, subscriptionId | extend type = replace(@\\\"microsoft.resources/subscriptions/resourcegroups\\\", @\\\"Resource Groups\\\", type)\",\"size\":1,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"type\",\"formatter\":16,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"subscriptionId\",\"formatter\":5}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true}},\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"overview\"},\"name\":\"Query - Subscription Overview\"},{\"type\":1,\"content\":{\"json\":\"## Resource Counts\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"overview\"},\"name\":\"text - Overview Resource text\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Resources \\r\\n| extend type = case(\\r\\ntype contains 'microsoft.netapp/netappaccounts', 'NetApp Accounts',\\r\\ntype contains \\\"microsoft.compute\\\", \\\"Azure Compute\\\",\\r\\ntype contains \\\"microsoft.logic\\\", \\\"LogicApps\\\",\\r\\ntype contains 'microsoft.keyvault/vaults', \\\"Key Vaults\\\",\\r\\ntype contains 'microsoft.storage/storageaccounts', \\\"Storage Accounts\\\",\\r\\ntype contains 'microsoft.compute/availabilitysets', 'Availability Sets',\\r\\ntype contains 'microsoft.operationalinsights/workspaces', 'Azure Monitor Resources',\\r\\ntype contains 'microsoft.operationsmanagement', 'Operations Management Resources',\\r\\ntype contains 'microsoft.insights', 'Azure Monitor Resources',\\r\\ntype contains 'microsoft.desktopvirtualization/applicationgroups', 'WVD Application Groups',\\r\\ntype contains 'microsoft.desktopvirtualization/workspaces', 'WVD Workspaces',\\r\\ntype contains 'microsoft.desktopvirtualization/hostpools', 'WVD Hostpools',\\r\\ntype contains 'microsoft.recoveryservices/vaults', 'Backup Vaults',\\r\\ntype contains 'microsoft.web', 'App Services',\\r\\ntype contains 'microsoft.managedidentity/userassignedidentities','Managed Identities',\\r\\ntype contains 'microsoft.storagesync/storagesyncservices', 'Azure File Sync',\\r\\ntype contains 'microsoft.hybridcompute/machines', 'ARC Machines',\\r\\ntype contains 'Microsoft.EventHub', 'Event Hub',\\r\\ntype contains 'Microsoft.EventGrid', 'Event Grid',\\r\\ntype contains 'Microsoft.Sql', 'SQL Resources',\\r\\ntype contains 'Microsoft.HDInsight/clusters', 'HDInsight Clusters',\\r\\ntype contains 'microsoft.devtestlab', 'DevTest Labs Resources',\\r\\ntype contains 'microsoft.containerinstance', 'Container Instances Resources',\\r\\ntype contains 'microsoft.portal/dashboards', 'Azure Dashboards',\\r\\ntype contains 'microsoft.containerregistry/registries', 'Container Registry',\\r\\ntype contains 'microsoft.automation', 'Automation Resources',\\r\\ntype contains 'sendgrid.email/accounts', 'SendGrid Accounts',\\r\\ntype contains 'microsoft.datafactory/factories', 'Data Factory',\\r\\ntype contains 'microsoft.databricks/workspaces', 'Databricks Workspaces',\\r\\ntype contains 'microsoft.machinelearningservices/workspaces', 'Machine Learnings Workspaces',\\r\\ntype contains 'microsoft.alertsmanagement/smartdetectoralertrules', 'Azure Monitor Resources',\\r\\ntype contains 'microsoft.apimanagement/service', 'API Management Services',\\r\\ntype contains 'microsoft.dbforpostgresql', 'PostgreSQL Resources',\\r\\ntype contains 'microsoft.scheduler/jobcollections', 'Scheduler Job Collections',\\r\\ntype contains 'microsoft.visualstudio/account', 'Azure DevOps Organization',\\r\\ntype contains 'microsoft.network/', 'Network Resources',\\r\\ntype contains 'microsoft.migrate/' or type contains 'microsoft.offazure', 'Azure Migrate Resources',\\r\\ntype contains 'microsoft.servicebus/namespaces', 'Service Bus Namespaces',\\r\\ntype contains 'microsoft.classic', 'ASM Obsolete Resources',\\r\\ntype contains 'microsoft.resources/templatespecs', 'Template Spec Resources',\\r\\ntype contains 'microsoft.virtualmachineimages', 'VM Image Templates',\\r\\ntype contains 'microsoft.documentdb', 'CosmosDB DB Resources',\\r\\ntype contains 'microsoft.alertsmanagement/actionrules', 'Azure Monitor Resources',\\r\\ntype contains 'microsoft.kubernetes/connectedclusters', 'ARC Kubernetes Clusters',\\r\\ntype contains 'microsoft.purview', 'Purview Resources',\\r\\ntype contains 'microsoft.security', 'Security Resources',\\r\\ntype contains 'microsoft.cdn', 'CDN Resources',\\r\\ntype contains 'microsoft.devices','IoT Resources',\\r\\ntype contains 'microsoft.datamigration', 'Data Migraiton Services',\\r\\ntype contains 'microsoft.cognitiveservices', 'Congitive Services',\\r\\ntype contains 'microsoft.customproviders', 'Custom Providers',\\r\\ntype contains 'microsoft.appconfiguration', 'App Services',\\r\\ntype contains 'microsoft.search', 'Search Services',\\r\\ntype contains 'microsoft.maps', 'Maps',\\r\\ntype contains 'microsoft.containerservice/managedclusters', 'AKS',\\r\\ntype contains 'microsoft.signalrservice', 'SignalR',\\r\\ntype contains 'microsoft.resourcegraph/queries', 'Resource Graph Queries',\\r\\ntype contains 'microsoft.batch', 'MS Batch',\\r\\ntype contains 'microsoft.analysisservices', 'Analysis Services',\\r\\ntype contains 'microsoft.synapse/workspaces', 'Synapse Workspaces',\\r\\ntype contains 'microsoft.synapse/workspaces/sqlpools', 'Synapse SQL Pools',\\r\\ntype contains 'microsoft.kusto/clusters', 'ADX Clusters',\\r\\ntype contains 'microsoft.resources/deploymentscripts', 'Deployment Scripts',\\r\\ntype contains 'microsoft.aad/domainservices', 'AD Domain Services',\\r\\ntype contains 'microsoft.labservices/labaccounts', 'Lab Accounts',\\r\\ntype contains 'microsoft.automanage/accounts', 'Automanage Accounts',\\r\\ntype contains 'microsoft.relay/namespaces', 'Azure Relay',\\r\\ntype contains 'microsoft.notificationhubs/namespaces', 'Notification Hubs',\\r\\ntype contains 'microsoft.digitaltwins/digitaltwinsinstances', 'Digital Twins',\\r\\nstrcat(\\\"Not Translated: \\\", type))\\r\\n| summarize count() by type\",\"size\":2,\"title\":\"Resource Count by Type\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":true,\"sortCriteriaField\":\"count_\",\"sortOrderField\":2}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"overview\"},\"name\":\"query - Overview Resource Counts by type\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Intune Devices\",\"items\":[{\"type\":1,\"content\":{\"json\":\"<h1>Intune Dashboard</h1>\"},\"name\":\"text - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"IntuneDevices | summarize by SerialNumber | count\",\"size\":3,\"title\":\"Total Number of Intune Devices\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"/subscriptions/03648514-5be8-4be8-ba64-cfaa241b2448/resourceGroups/Azure-Sentinel-RG/providers/Microsoft.OperationalInsights/workspaces/LuckAzureSentinel\"],\"visualization\":\"card\",\"tileSettings\":{\"titleContent\":{},\"leftContent\":{\"columnMatch\":\"Count\"},\"showBorder\":true},\"graphSettings\":{\"type\":0},\"textSettings\":{\"style\":\"bignumber\"}},\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Visualize iOS Versions and filtering for devices that had a connection to intune in the last 30 days.\\r\\nIntuneDevices\\r\\n| where OS contains \\\"iOS/iPadOS\\\"\\r\\n| where todatetime(LastContact) > ago(30d) \\r\\n| summarize arg_max(TimeGenerated, *) by DeviceName\\r\\n| summarize Versionen=count() by OSVersion\\r\\n| sort by Versionen desc \\r\\n| render piechart with ( title=\\\"iOS/iPadOS Versions\\\")\",\"size\":3,\"title\":\"iOS/iPadOS Versions\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"/subscriptions/03648514-5be8-4be8-ba64-cfaa241b2448/resourceGroups/Azure-Sentinel-RG/providers/Microsoft.OperationalInsights/workspaces/LuckAzureSentinel\"]},\"customWidth\":\"25\",\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Visualize Windows Versions and filtering for devices that had a connection to intune in the last 30 days.\\r\\nIntuneDevices\\r\\n| where OS contains \\\"Windows\\\"\\r\\n| where todatetime(LastContact) > ago(30d) \\r\\n| summarize arg_max(TimeGenerated, *) by DeviceName\\r\\n| summarize Versionen=count() by OSVersion\\r\\n| sort by Versionen desc \\r\\n| render piechart with ( title=\\\"Windows Build Versions\\\")\",\"size\":3,\"title\":\"Windows Versions\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"/subscriptions/03648514-5be8-4be8-ba64-cfaa241b2448/resourceGroups/Azure-Sentinel-RG/providers/Microsoft.OperationalInsights/workspaces/LuckAzureSentinel\"]},\"customWidth\":\"25\",\"name\":\"query - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Visualize Number of Devices with different SKU (Pro and Enterprise Versions)\\r\\nIntuneDevices\\r\\n| where OS == \\\"Windows\\\"\\r\\n| where todatetime(LastContact) > ago(30d) // filter for devices that have contacted intune in the last 30 days\\r\\n| summarize arg_max(TimeGenerated, *) by DeviceName\\r\\n| summarize Number=count() by SkuFamily\\r\\n| render piechart \",\"size\":3,\"title\":\"Windows SKU\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"/subscriptions/03648514-5be8-4be8-ba64-cfaa241b2448/resourceGroups/Azure-Sentinel-RG/providers/Microsoft.OperationalInsights/workspaces/LuckAzureSentinel\"]},\"customWidth\":\"25\",\"name\":\"query - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// List of all Devices that where added to Intune with OS Platform information in a specific timeframe\\r\\nIntuneDevices\\r\\n \\r\\n| where Ownership == \\\"Corporate\\\"\\r\\n| project DeviceName, OS, OSVersion, UserName, CreatedDate\\r\\n| summarize count(DeviceName) by OS\",\"size\":3,\"title\":\"Count of Corporate Devices by OS Platform\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"/subscriptions/03648514-5be8-4be8-ba64-cfaa241b2448/resourceGroups/Azure-Sentinel-RG/providers/Microsoft.OperationalInsights/workspaces/LuckAzureSentinel\"],\"visualization\":\"table\",\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_DeviceName\",\"label\":\"Count\"}]}},\"customWidth\":\"25\",\"name\":\"query - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"IntuneDevices\\r\\n//Gets all data generated in 180 days\\r\\n| where TimeGenerated > ago(180d) \\r\\n//Optionally filter only devices have contact to Intune in 30 days\\r\\n| where todatetime(LastContact) > ago (30d) \\r\\n| summarize arg_max(TimeGenerated, *) by DeviceName, startofweek(TimeGenerated)\\r\\n| where OS == \\\"Windows\\\"\\r\\n| summarize JoinSummary=count()by JoinType, startofweek(TimeGenerated)\\r\\n| where isnotempty(JoinType)\\r\\n| render columnchart\\r\\n    with (\\r\\n    kind=unstacked,\\r\\n    ytitle=\\\"Device Count\\\",\\r\\n    xtitle=\\\"Week\\\",\\r\\n    title=\\\"Device count by join type per week\\\") \",\"size\":0,\"title\":\"Join Types\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"/subscriptions/03648514-5be8-4be8-ba64-cfaa241b2448/resourceGroups/Azure-Sentinel-RG/providers/Microsoft.OperationalInsights/workspaces/LuckAzureSentinel\"],\"visualization\":\"timechart\"},\"customWidth\":\"50\",\"name\":\"query - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Visualize device compliance (compliant, non-compliant, managed by Config Manager, not evaluated or in grace period) per week over time\\r\\nIntuneDevices\\r\\n| where TimeGenerated > ago (30d)\\r\\n| summarize arg_max(DeviceName, *) by DeviceName\\r\\n| where isnotempty(CompliantState)\\r\\n| summarize ComplianceCount=count()by CompliantState\\r\\n| render piechart \\r\\n    with (title=\\\"Device compliance\\\")\",\"size\":3,\"title\":\"Intune Device Compliance\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"/subscriptions/03648514-5be8-4be8-ba64-cfaa241b2448/resourceGroups/Azure-Sentinel-RG/providers/Microsoft.OperationalInsights/workspaces/LuckAzureSentinel\"]},\"customWidth\":\"25\",\"name\":\"query - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let Monthly = \\r\\nIntuneDeviceComplianceOrg\\r\\n| where todatetime(LastContact) > ago(30d)\\r\\n| summarize arg_max(TimeGenerated, *) by DeviceName\\r\\n| summarize count(DeviceName)\\r\\n| extend CustomName=\\\"Active Devices\\\"\\r\\n| extend MonthlyCount=count_DeviceName;\\r\\nlet Weekly=\\r\\nIntuneDeviceComplianceOrg\\r\\n| where todatetime(LastContact) > ago(7d)\\r\\n| summarize arg_max(TimeGenerated, *) by DeviceName\\r\\n| summarize count(DeviceName)\\r\\n| extend CustomName=\\\"Active Devices\\\"\\r\\n| extend WeeklyCount=count_DeviceName;\\r\\nMonthly\\r\\n| join kind=inner Weekly on CustomName\\r\\n| project-rename ['Last 30 Days']=MonthlyCount, ['Last 7 Days'] = WeeklyCount, Description=CustomName\\r\\n| project Description,['Last 7 Days'],['Last 30 Days']\",\"size\":0,\"title\":\"Devices Active in 7 & 30 Days\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"/subscriptions/03648514-5be8-4be8-ba64-cfaa241b2448/resourceGroups/Azure-Sentinel-RG/providers/Microsoft.OperationalInsights/workspaces/LuckAzureSentinel\"]},\"customWidth\":\"25\",\"name\":\"query - 9\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// List of device models and Manufacturers and number of devices for each model\\r\\nIntuneDevices\\r\\n| summarize count(DeviceName) by Model, Manufacturer\",\"size\":0,\"title\":\"Count of Device Type by Manufacturer\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"/subscriptions/03648514-5be8-4be8-ba64-cfaa241b2448/resourceGroups/Azure-Sentinel-RG/providers/Microsoft.OperationalInsights/workspaces/LuckAzureSentinel\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"count_DeviceName\",\"label\":\"Count\"}]}},\"name\":\"query - 6\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"intune\"},\"name\":\"group - 133\"},{\"type\":1,\"content\":{\"json\":\"## NoShow - End Overview\\r\\n\\r\\n\\r\\n## NoShow - Begin Compute\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow Begin Compute\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"a5b84469-ab4c-4b30-9983-22c454d61468\",\"cellValue\":\"compute\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Azure Compute\",\"subTarget\":\"azure\",\"style\":\"link\"},{\"id\":\"d44b3ab8-d86b-4c5c-939f-273554437a4e\",\"cellValue\":\"compute\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Hybrid Compute\",\"subTarget\":\"arc\",\"style\":\"link\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"compute\"},\"name\":\"tabs -  Compute\"},{\"type\":1,\"content\":{\"json\":\"## Current VM Status\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"compute\"},{\"parameterName\":\"compute\",\"comparison\":\"isEqualTo\",\"value\":\"azure\"}],\"name\":\"text - Azure Compute\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Resources | where type == \\\"microsoft.compute/virtualmachines\\\"\\r\\n| extend vmState = tostring(properties.extended.instanceView.powerState.displayStatus)\\r\\n| extend vmState = iif(isempty(vmState), \\\"VM State Unknown\\\", (vmState))\\r\\n| summarize count() by vmState\",\"size\":4,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"vmState\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false,\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}}},\"showBorder\":true},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"vmSize\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"compute\"},{\"parameterName\":\"compute\",\"comparison\":\"isEqualTo\",\"value\":\"azure\"}],\"name\":\"query - Azure Compute Summary - Copy\"},{\"type\":1,\"content\":{\"json\":\"## Count of VMs by VM Size.\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"compute\"},{\"parameterName\":\"compute\",\"comparison\":\"isEqualTo\",\"value\":\"azure\"}],\"name\":\"text - Azure Compute - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Resources | where type =~ \\\"microsoft.compute/virtualmachines\\\"\\r\\nor type =~ 'microsoft.compute/virtualmachinescalesets'\\r\\n| extend Size = case(\\r\\ntype contains 'microsoft.compute/virtualmachinescalesets', strcat(\\\"VMSS \\\", sku.name),\\r\\ntype contains 'microsoft.compute/virtualmachines', properties.hardwareProfile.vmSize,\\r\\n\\\"Size not found\\\")\\r\\n| summarize Count=count(Size) by vmSize=tostring(Size)\",\"size\":0,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"vmSize\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"vmSize\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"compute\"},{\"parameterName\":\"compute\",\"comparison\":\"isEqualTo\",\"value\":\"azure\"}],\"name\":\"query - Azure Compute Summary\"},{\"type\":1,\"content\":{\"json\":\"## VMs by Storage and Networking\\r\\n\\r\\nüí° Select tab to see corresponding breakdown\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"compute\"},{\"parameterName\":\"compute\",\"comparison\":\"isEqualTo\",\"value\":\"azure\"}],\"name\":\"text - Azure Compute - Copy\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"d99f06e7-b625-4b75-b01c-c6cae7661d2f\",\"cellValue\":\"hardware\",\"linkTarget\":\"parameter\",\"linkLabel\":\"VM Scale Sets\",\"subTarget\":\"vmss\",\"style\":\"link\"},{\"id\":\"2c1dc7ff-d1c2-4214-9289-6ec960f405b8\",\"cellValue\":\"hardware\",\"linkTarget\":\"parameter\",\"linkLabel\":\"VM Overview\",\"subTarget\":\"overview\",\"style\":\"link\"},{\"id\":\"9ba284c0-ba39-460c-9f74-b9ae8845245c\",\"cellValue\":\"hardware\",\"linkTarget\":\"parameter\",\"linkLabel\":\"VM Storage\",\"subTarget\":\"storage\",\"style\":\"link\"},{\"id\":\"ac392a07-01a6-4727-b82b-117c529867c7\",\"cellValue\":\"hardware\",\"linkTarget\":\"parameter\",\"linkLabel\":\"VM Networking\",\"subTarget\":\"network\",\"style\":\"link\"},{\"id\":\"74bab549-0028-4018-8bf3-065b6c6fa28e\",\"cellValue\":\"hardware\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Orphaned Disks\",\"subTarget\":\"orphaneddisks\",\"style\":\"link\"},{\"id\":\"a45a3005-c5b6-46a7-8873-ac1e471c51b4\",\"cellValue\":\"hardware\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Orphaned NICs\",\"subTarget\":\"orphanednics\",\"style\":\"link\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"compute\"},{\"parameterName\":\"compute\",\"comparison\":\"isEqualTo\",\"value\":\"azure\"}],\"name\":\"links - Azure Compute Storage Networking Breakdown\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources \\r\\n| where type has 'microsoft.compute/virtualmachinescalesets'\\r\\n| extend Size = sku.name\\r\\n| extend Capacity = sku.capacity\\r\\n| extend UpgradeMode = properties.upgradePolicy.mode\\r\\n| extend OSType = properties.virtualMachineProfile.storageProfile.osDisk.osType\\r\\n| extend OS = properties.virtualMachineProfile.storageProfile.imageReference.offer\\r\\n| extend OSVersion = properties.virtualMachineProfile.storageProfile.imageReference.sku\\r\\n| extend OverProvision = properties.overprovision\\r\\n| extend ZoneBalance = properties.zoneBalance\\r\\n| extend Details = pack_all()\\r\\n| project VMSS = id, location, resourceGroup, subscriptionId, Size, Capacity, OSType, UpgradeMode, OverProvision, Details\",\"size\":2,\"noDataMessage\":\"No VM Scale Sets found\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"VMSS\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"Size\",\"formatter\":1},{\"columnMatch\":\"Capacity\",\"formatter\":1},{\"columnMatch\":\"OSType\",\"formatter\":1},{\"columnMatch\":\"UpgradeMode\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Manual\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"success\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"OverProvision\",\"formatter\":1},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"vmId\",\"formatter\":5}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"VMSS\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"vmSize\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"vmSize\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"compute\"},{\"parameterName\":\"compute\",\"comparison\":\"isEqualTo\",\"value\":\"azure\"},{\"parameterName\":\"hardware\",\"comparison\":\"isEqualTo\",\"value\":\"vmss\"}],\"name\":\"query - Azure Compute VMSS\",\"styleSettings\":{\"padding\":\"0 0 200px 0\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Resources \\r\\n| where type == \\\"microsoft.compute/virtualmachines\\\"\\r\\n| extend vmID = tolower(id)\\r\\n| extend osDiskId= tolower(tostring(properties.storageProfile.osDisk.managedDisk.id))\\r\\n| extend provisioningState = tostring(properties.extended.instanceView.powerState.displayStatus)\\r\\n        | join kind=leftouter(resources\\r\\n            | where type =~ 'microsoft.compute/disks'\\r\\n            | where properties !has 'Unattached'\\r\\n            | where properties has 'osType'\\r\\n            | project timeCreated = tostring(properties.timeCreated), OS = tostring(properties.osType), osSku = tostring(sku.name), osDiskSizeGB = toint(properties.diskSizeGB), osDiskId=tolower(tostring(id))) on osDiskId\\r\\n        | join kind=leftouter(resources\\r\\n\\t\\t\\t| where type =~ 'microsoft.compute/availabilitysets'\\r\\n\\t\\t\\t| extend VirtualMachines = array_length(properties.virtualMachines)\\r\\n\\t\\t\\t| mv-expand VirtualMachine=properties.virtualMachines\\r\\n\\t\\t\\t| extend FaultDomainCount = properties.platformFaultDomainCount\\r\\n\\t\\t\\t| extend UpdateDomainCount = properties.platformUpdateDomainCount\\r\\n\\t\\t\\t| extend vmID = tolower(VirtualMachine.id)\\r\\n\\t\\t\\t| project AvailabilitySetID = id, vmID, FaultDomainCount, UpdateDomainCount ) on vmID\\r\\n\\t\\t| join kind=leftouter(resources\\r\\n\\t\\t\\t| where type =~ 'microsoft.sqlvirtualmachine/sqlvirtualmachines'\\r\\n\\t\\t\\t| extend SQLLicense = properties.sqlServerLicenseType\\r\\n\\t\\t\\t| extend SQLImage = properties.sqlImageOffer\\r\\n\\t\\t\\t| extend SQLSku = properties.sqlImageSku\\r\\n\\t\\t\\t| extend SQLManagement = properties.sqlManagement\\r\\n\\t\\t\\t| extend vmID = tostring(tolower(properties.virtualMachineResourceId))\\r\\n\\t\\t\\t| project SQLId=id, SQLLicense, SQLImage, SQLSku, SQLManagement, vmID ) on vmID\\r\\n| project-away vmID1, vmID2, osDiskId1\\r\\n| extend Details = pack_all()\\r\\n| project vmID, SQLId, AvailabilitySetID, provisioningState, OS, resourceGroup, location, subscriptionId, SQLLicense, SQLImage,SQLSku, SQLManagement, FaultDomainCount, UpdateDomainCount, Details\",\"size\":2,\"noDataMessage\":\"No VMs found\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"vmID\",\"formatter\":5},{\"columnMatch\":\"SQLId\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true,\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"resourceGroup\",\"formatter\":5},{\"columnMatch\":\"location\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"SQLLicense\",\"formatter\":1},{\"columnMatch\":\"SQLImage\",\"formatter\":1},{\"columnMatch\":\"SQLSku\",\"formatter\":1},{\"columnMatch\":\"SQLManagement\",\"formatter\":1},{\"columnMatch\":\"FaultDomainCount\",\"formatter\":1},{\"columnMatch\":\"UpdateDomainCount\",\"formatter\":1},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"vmId\",\"formatter\":5},{\"columnMatch\":\"timeCreated\",\"formatter\":6}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"vmID\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"vmSize\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"vmSize\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"compute\"},{\"parameterName\":\"compute\",\"comparison\":\"isEqualTo\",\"value\":\"azure\"},{\"parameterName\":\"hardware\",\"comparison\":\"isEqualTo\",\"value\":\"overview\"}],\"name\":\"query - Azure Compute Overview\",\"styleSettings\":{\"padding\":\"0 0 200px 0\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Resources \\r\\n| where type == \\\"microsoft.compute/virtualmachines\\\"\\r\\n| extend osDiskId= tolower(tostring(properties.storageProfile.osDisk.managedDisk.id))\\r\\n        | join kind=leftouter(resources\\r\\n            | where type =~ 'microsoft.compute/disks'\\r\\n            | where properties !has 'Unattached'\\r\\n            | where properties has 'osType'\\r\\n            | project timeCreated = tostring(properties.timeCreated), OS = tostring(properties.osType), osSku = tostring(sku.name), osDiskSizeGB = toint(properties.diskSizeGB), osDiskId=tolower(tostring(id))) on osDiskId\\r\\n        | join kind=leftouter(Resources\\r\\n            | where type =~ 'microsoft.compute/disks'\\r\\n            | where properties !has \\\"osType\\\"\\r\\n            | where properties !has 'Unattached'\\r\\n            | project sku = tostring(sku.name), diskSizeGB = toint(properties.diskSizeGB), id = managedBy\\r\\n            | summarize sum(diskSizeGB), count(sku) by id, sku) on id\\r\\n| project vmId=id, OS, location, resourceGroup, timeCreated,subscriptionId, osDiskId, osSku, osDiskSizeGB, DataDisksGB=sum_diskSizeGB, diskSkuCount=count_sku\\r\\n| sort by diskSkuCount desc\",\"size\":2,\"noDataMessage\":\"No VMs found\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"vmId\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"timeCreated\",\"formatter\":6}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"vmId\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"vmSize\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"vmSize\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"compute\"},{\"parameterName\":\"compute\",\"comparison\":\"isEqualTo\",\"value\":\"azure\"},{\"parameterName\":\"hardware\",\"comparison\":\"isEqualTo\",\"value\":\"storage\"}],\"name\":\"query - Azure Compute Disks\",\"styleSettings\":{\"padding\":\"0 0 200px 0\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Resources\\r\\n| where type =~ 'microsoft.compute/virtualmachines'\\r\\n| extend nics=array_length(properties.networkProfile.networkInterfaces)\\r\\n| mv-expand nic=properties.networkProfile.networkInterfaces\\r\\n| where nics == 1 or nic.properties.primary =~ 'true' or isempty(nic)\\r\\n| project vmId = id, vmName = name, vmSize=tostring(properties.hardwareProfile.vmSize), nicId = tostring(nic.id)\\r\\n\\t| join kind=leftouter (\\r\\n \\t\\tResources\\r\\n  \\t\\t| where type =~ 'microsoft.network/networkinterfaces'\\r\\n  \\t\\t| extend ipConfigsCount=array_length(properties.ipConfigurations)\\r\\n  \\t\\t| mv-expand ipconfig=properties.ipConfigurations\\r\\n  \\t\\t| where ipConfigsCount == 1 or ipconfig.properties.primary =~ 'true'\\r\\n  \\t\\t| project nicId = id, privateIP= tostring(ipconfig.properties.privateIPAddress), publicIpId = tostring(ipconfig.properties.publicIPAddress.id), subscriptionId) on nicId\\r\\n| project-away nicId1\\r\\n| summarize by vmId, vmSize, nicId, privateIP, publicIpId, subscriptionId\\r\\n\\t| join kind=leftouter (\\r\\n  \\t\\tResources\\r\\n  \\t\\t| where type =~ 'microsoft.network/publicipaddresses'\\r\\n  \\t\\t| project publicIpId = id, publicIpAddress = tostring(properties.ipAddress)) on publicIpId\\r\\n| project-away publicIpId1\\r\\n| sort by publicIpAddress desc\",\"size\":2,\"noDataMessage\":\"No VMs found\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"vmId\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"vmId\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"vmSize\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"vmSize\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"compute\"},{\"parameterName\":\"compute\",\"comparison\":\"isEqualTo\",\"value\":\"azure\"},{\"parameterName\":\"hardware\",\"comparison\":\"isEqualTo\",\"value\":\"network\"}],\"name\":\"query - Azure Compute Networking\",\"styleSettings\":{\"padding\":\"0 0 200px 0\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Resources  \\r\\n| where type contains \\\"microsoft.compute/disks\\\" \\r\\n| extend diskState = tostring(properties.diskState)\\r\\n| where managedBy == \\\"\\\" and diskState != 'ActiveSAS'\\r\\nor diskState == 'Unattached' and diskState != 'ActiveSAS'\\r\\n| project id, diskState, resourceGroup, location, subscriptionId\",\"size\":2,\"noDataMessage\":\"No oprhaned disks found\",\"noDataMessageStyle\":3,\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"id\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"vmSize\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"vmSize\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"compute\"},{\"parameterName\":\"compute\",\"comparison\":\"isEqualTo\",\"value\":\"azure\"},{\"parameterName\":\"hardware\",\"comparison\":\"isEqualTo\",\"value\":\"orphaneddisks\"}],\"name\":\"query - Azure Compute - Orphaned Disks\",\"styleSettings\":{\"padding\":\"0 0 200px 0\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type =~ \\\"microsoft.network/networkinterfaces\\\"\\r\\n| join kind=leftouter (resources\\r\\n| where type =~ 'microsoft.network/privateendpoints'\\r\\n| extend nic = todynamic(properties.networkInterfaces)\\r\\n| mv-expand nic\\r\\n| project id=tostring(nic.id) ) on id\\r\\n| where isempty(id1)\\r\\n| where properties !has 'virtualmachine'\\r\\n| project id, resourceGroup, location, subscriptionId\",\"size\":2,\"noDataMessage\":\"No orphaned nics found\",\"noDataMessageStyle\":3,\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"id\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"vmSize\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"vmSize\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"compute\"},{\"parameterName\":\"compute\",\"comparison\":\"isEqualTo\",\"value\":\"azure\"},{\"parameterName\":\"hardware\",\"comparison\":\"isEqualTo\",\"value\":\"orphanednics\"}],\"name\":\"query - Azure Compute Orphaned NICs\",\"styleSettings\":{\"padding\":\"0 0 200px 0\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"where type == \\\"microsoft.hybridcompute/machines\\\"\\r\\n| project MachineId=id, status = properties.status, \\r\\n\\t\\t\\t  LastSeen = properties.lastStatusChange, \\r\\n\\t\\t\\t  FQDN = properties.machineFqdn, \\r\\n\\t\\t\\t  OS = properties.osName, \\r\\n\\t\\t\\t  ServerVersion = properties.osVersion\\r\\n| extend ServerVersion = case(\\r\\n    ServerVersion has '10.0.20348', 'Server 2022',\\r\\n    ServerVersion has '10.0.17763', 'Server 2019',\\r\\n    ServerVersion has '10.0.16299', 'Server 2016',\\r\\n    ServerVersion has '10.0.14393', 'Server 2016',\\r\\n    ServerVersion has '6.3.9600', 'Server 2012 R2',\\r\\n\\tServerVersion)\",\"size\":0,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"status\",\"formatter\":1},{\"columnMatch\":\"LastSeen\",\"formatter\":1},{\"columnMatch\":\"FQDN\",\"formatter\":1},{\"columnMatch\":\"OS\",\"formatter\":1},{\"columnMatch\":\"ServerVersion\",\"formatter\":1}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"vmSize\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"Count\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"vmSize\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"Count\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"compute\"},{\"parameterName\":\"compute\",\"comparison\":\"isEqualTo\",\"value\":\"arc\"}],\"name\":\"query - ARC Machines Inventory\"},{\"type\":1,\"content\":{\"json\":\"## NoShow - End Compute\\r\\n\\r\\n## NoShow - Begin PaaS\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow Beging Networking\"},{\"type\":1,\"content\":{\"json\":\"## PaaS Resources\\r\\n\\r\\nüí° Select tab to view releated resources for PaaS Services\\r\\n\\r\\n\\r\\n\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},\"name\":\"text - PaaS Text\",\"styleSettings\":{\"padding\":\"0 0 15px 0\"}},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"a4ee3213-3bfc-4333-b798-934e866c48de\",\"cellValue\":\"paas\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Automation\",\"subTarget\":\"automation\",\"style\":\"link\"},{\"id\":\"c5ba791c-2cc3-4c32-8b5c-eab75cc0354c\",\"cellValue\":\"paas\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Application Resources\",\"subTarget\":\"apps\",\"style\":\"link\"},{\"id\":\"4b819d18-9495-450b-99bd-40009f1babc7\",\"cellValue\":\"paas\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Containers\",\"subTarget\":\"containers\",\"style\":\"link\"},{\"id\":\"ed78617d-664d-4727-87c6-91ac79010e2d\",\"cellValue\":\"paas\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Data\",\"subTarget\":\"data\",\"style\":\"link\"},{\"id\":\"8d82d272-3094-4750-a058-9122b11ae50b\",\"cellValue\":\"paas\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Events\",\"subTarget\":\"events\",\"style\":\"link\"},{\"id\":\"1dfce15d-7329-46ab-971a-09fc9fbc941b\",\"cellValue\":\"paas\",\"linkTarget\":\"parameter\",\"linkLabel\":\"IoT\",\"subTarget\":\"iot\",\"style\":\"link\"},{\"id\":\"98122f89-2281-4cee-9681-1212ee8ea496\",\"cellValue\":\"paas\",\"linkTarget\":\"parameter\",\"linkLabel\":\"ML/AI\",\"subTarget\":\"mlai\",\"style\":\"link\"},{\"id\":\"a4e4ea2e-4c32-4143-92bd-27473db8bc81\",\"cellValue\":\"paas\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Storage and Backup\",\"subTarget\":\"storage\",\"style\":\"link\"},{\"id\":\"5623ad81-d28e-4b04-9d05-03197472a894\",\"cellValue\":\"paas\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Windows Virtual Desktop\",\"subTarget\":\"wvd\",\"style\":\"link\"},{\"id\":\"a9f5d871-e0ec-4da4-bf1e-7edc2b5cd75e\",\"cellValue\":\"paas\",\"linkTarget\":\"parameter\",\"linkLabel\":\"SQL\",\"subTarget\":\"sql\",\"style\":\"link\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},\"name\":\"links - PaaS Tabs\",\"styleSettings\":{\"padding\":\"0 0 15px 0\"}},{\"type\":1,\"content\":{\"json\":\"### Count of all Resource Types\\r\\n\\r\\n\\r\\n\\r\\n\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},\"name\":\"text - PaaS Text - Overview\",\"styleSettings\":{\"padding\":\"0 0 10px 0\"}},{\"type\":1,\"content\":{\"json\":\"### NoShow - Begin PaaS - Automation\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow Begin Automation\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type has 'microsoft.automation'\\r\\n\\tor type has 'microsoft.logic'\\r\\n\\tor type has 'microsoft.web/customapis'\\r\\n\\r\\n| extend type = case(\\r\\n\\ttype =~ 'microsoft.automation/automationaccounts', 'Automation Accounts',\\r\\n\\ttype == 'microsoft.web/serverfarms', \\\"App Service Plans\\\",\\r\\n\\tkind == 'functionapp', \\\"Azure Functions\\\", \\r\\n\\tkind == \\\"api\\\", \\\"API Apps\\\", \\r\\n\\ttype == 'microsoft.web/sites', \\\"App Services\\\",\\r\\n\\ttype =~ 'microsoft.web/connections', 'LogicApp Connectors',\\r\\n\\ttype =~ 'microsoft.web/customapis','LogicApp API Connectors',\\r\\n\\ttype =~ 'microsoft.logic/workflows','LogicApps',\\r\\n    type =~ 'microsoft.logic/integrationaccounts', 'Integration Accounts',\\r\\n\\ttype =~ 'microsoft.automation/automationaccounts/runbooks', 'Automation Runbooks',\\r\\n    type =~ 'microsoft.automation/automationaccounts/configurations', 'Automation Configurations',\\r\\n\\r\\nstrcat(\\\"Not Translated: \\\", type))\\r\\n| summarize count() by type\\r\\n| where type !has \\\"Not Translated\\\"\",\"size\":1,\"noDataMessage\":\"No resources found\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortCriteriaField\":\"type\",\"sortOrderField\":1}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"automation\"}],\"name\":\"query - PaaS - Automation Overview\"},{\"type\":1,\"content\":{\"json\":\"### Detailed View\\r\\n\\r\\nüí° select 'View Details' to see full return from Azure Resource Graph\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"automation\"}],\"name\":\"text - PaaS Text - Automation - Details \"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type has 'microsoft.automation'\\r\\n\\t or type has 'microsoft.logic'\\r\\n\\t or type has 'microsoft.web/customapis'\\r\\n\\r\\n| extend type = case(\\r\\n\\ttype =~ 'microsoft.automation/automationaccounts', 'Automation Accounts',\\r\\n\\ttype =~ 'microsoft.web/connections', 'LogicApp Connectors',\\r\\n\\ttype =~ 'microsoft.web/customapis','LogicApp API Connectors',\\r\\n\\ttype =~ 'microsoft.logic/workflows','LogicApps',\\r\\n    type =~ 'microsoft.logic/integrationaccounts', 'Integration Accounts',\\r\\n\\ttype =~ 'microsoft.automation/automationaccounts/runbooks', 'Automation Runbooks',\\r\\n\\ttype =~ 'microsoft.automation/automationaccounts/configurations', 'Automation Configurations',\\r\\n\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| extend RunbookType = tostring(properties.runbookType)\\r\\n| extend LogicAppTrigger = properties.definition.triggers\\r\\n| extend LogicAppTrigger = iif(type =~ 'LogicApps', case(\\r\\n\\tLogicAppTrigger has 'manual', tostring(LogicAppTrigger.manual.type),\\r\\n\\tLogicAppTrigger has 'Recurrence', tostring(LogicAppTrigger.Recurrence.type),\\r\\n    LogicAppTrigger has 'When_an_Azure_Security_Center_Alert', 'Azure Security Center Alert',\\r\\n    LogicAppTrigger has 'When_an_Azure_Security_Center_Recommendation', 'Azure Security Center Recommendation',\\r\\n    LogicAppTrigger has 'When_a_response_to_an_Azure_Sentinel_alert', 'Azure Sentinel Alert',\\r\\n    LogicAppTrigger has 'When_Azure_Sentinel_incident_creation', 'Azure Sentinel Incident',\\r\\n\\tstrcat(\\\"Unknown Trigger type\\\", LogicAppTrigger)), LogicAppTrigger)\\r\\n| extend State = case(\\r\\n\\ttype =~ 'Automation Runbooks', properties.state, \\r\\n\\ttype =~ 'LogicApps', properties.state,\\r\\n\\ttype =~ 'Automation Accounts', properties.state,\\r\\n\\ttype =~ 'Automation Configurations', properties.state,\\r\\n\\t' ')\\r\\n| extend CreatedDate = case(\\r\\n\\ttype =~ 'Automation Runbooks', properties.creationTime, \\r\\n\\ttype =~ 'LogicApps', properties.createdTime,\\r\\n\\ttype =~ 'Automation Accounts', properties.creationTime,\\r\\n\\ttype =~ 'Automation Configurations', properties.creationTime,\\r\\n\\t' ')\\r\\n| extend LastModified = case(\\r\\n\\ttype =~ 'Automation Runbooks', properties.lastModifiedTime, \\r\\n\\ttype =~ 'LogicApps', properties.changedTime,\\r\\n\\ttype =~ 'Automation Accounts', properties.lastModifiedTime,\\r\\n\\ttype =~ 'Automation Configurations', properties.lastModifiedTime,\\r\\n\\t' ')\\r\\n| extend Details = pack_all()\\r\\n| project Resource=id, subscriptionId, type, resourceGroup, RunbookType, LogicAppTrigger, State, Details\",\"size\":2,\"noDataMessage\":\"No resources found\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"Resource\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Resource\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortCriteriaField\":\"type\",\"sortOrderField\":1}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"automation\"}],\"name\":\"query - PaaS - Automation Detailed\",\"styleSettings\":{\"padding\":\"0 0 200px 0\"}},{\"type\":1,\"content\":{\"json\":\"### NoShow - End PaaS - Automation\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow End - PaaS - Automation\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - Begin PaaS - Apps\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow Begin Automation\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type has 'microsoft.web'\\r\\n\\t or type =~ 'microsoft.apimanagement/service'\\r\\n\\t or type =~ 'microsoft.network/frontdoors'\\r\\n\\t or type =~ 'microsoft.network/applicationgateways'\\r\\n\\t or type =~ 'microsoft.appconfiguration/configurationstores'\\r\\n| extend type = case(\\r\\n\\ttype == 'microsoft.web/serverfarms', \\\"App Service Plans\\\",\\r\\n\\tkind == 'functionapp', \\\"Azure Functions\\\", \\r\\n\\tkind == \\\"api\\\", \\\"API Apps\\\", \\r\\n\\ttype == 'microsoft.web/sites', \\\"App Services\\\",\\r\\n\\ttype =~ 'microsoft.network/applicationgateways', 'App Gateways',\\r\\n\\ttype =~ 'microsoft.network/frontdoors', 'Front Door',\\r\\n\\ttype =~ 'microsoft.apimanagement/service', 'API Management',\\r\\n\\ttype =~ 'microsoft.web/certificates', 'App Certificates',\\r\\n\\ttype =~ 'microsoft.appconfiguration/configurationstores', 'App Config Stores',\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| where type !has \\\"Not Translated\\\"\\r\\n| summarize count() by type\",\"size\":1,\"noDataMessage\":\"No resources found\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"Resource\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Resource\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortCriteriaField\":\"type\",\"sortOrderField\":1}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"apps\"}],\"name\":\"query - PaaS - Apps Overview\"},{\"type\":1,\"content\":{\"json\":\"### Detailed View\\r\\n\\r\\nüí° select 'View Details' to see full return from Azure Resource Graph\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"apps\"}],\"name\":\"text - PaaS Text - App Services Details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type has 'microsoft.web'\\r\\n\\t or type =~ 'microsoft.apimanagement/service'\\r\\n\\t or type =~ 'microsoft.network/frontdoors'\\r\\n\\t or type =~ 'microsoft.network/applicationgateways'\\r\\n\\t or type =~ 'microsoft.appconfiguration/configurationstores'\\r\\n| extend type = case(\\r\\n\\ttype == 'microsoft.web/serverfarms', strcat(\\\"App Service Plans - \\\", properties.kind),\\r\\n\\tkind == 'functionapp', \\\"Azure Functions\\\", \\r\\n\\tkind == \\\"api\\\", \\\"API Apps\\\", \\r\\n\\ttype == 'microsoft.web/sites', \\\"App Services\\\",\\r\\n\\ttype =~ 'microsoft.network/applicationgateways', 'App Gateways',\\r\\n\\ttype =~ 'microsoft.network/frontdoors', 'Front Door',\\r\\n\\ttype =~ 'microsoft.apimanagement/service', 'API Management',\\r\\n\\ttype =~ 'microsoft.web/certificates', 'App Certificates',\\r\\n\\ttype =~ 'microsoft.appconfiguration/configurationstores', 'App Config Stores',\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| where type !has \\\"Not Translated\\\"\\r\\n| extend Sku = case(\\r\\n\\ttype =~ 'App Gateways', properties.sku.name, \\r\\n\\ttype =~ 'Azure Functions', properties.sku,\\r\\n\\ttype =~ 'API Management', sku.name,\\r\\n\\ttype =~ 'App Service Plans', sku.name,\\r\\n\\ttype =~ 'App Services', properties.sku,\\r\\n\\ttype =~ 'App Config Stores', sku.name,\\r\\n\\t' ')\\r\\n| extend SiteCount = case(\\r\\n\\ttype contains 'App Service Plans', properties.numberOfSites,\\r\\n    ' ')\\r\\n| extend State = case(\\r\\n\\ttype =~ 'App Config Stores', properties.provisioningState,\\r\\n\\ttype contains 'App Service Plans', properties.status,\\r\\n\\ttype =~ 'Azure Functions', properties.enabled,\\r\\n\\ttype =~ 'App Services', properties.state,\\r\\n\\ttype =~ 'API Management', properties.provisioningState,\\r\\n\\ttype =~ 'App Gateways', properties.provisioningState,\\r\\n\\ttype =~ 'Front Door', properties.provisioningState,\\r\\n\\t' ')\\r\\n| mv-expand publicIpId=properties.frontendIPConfigurations\\r\\n| mv-expand publicIpId = publicIpId.properties.publicIPAddress.id\\r\\n| extend publicIpId = tostring(publicIpId)\\r\\n\\t| join kind=leftouter(\\r\\n\\t  \\tResources\\r\\n  \\t\\t| where type =~ 'microsoft.network/publicipaddresses'\\r\\n  \\t\\t| project publicIpId = id, publicIpAddress = tostring(properties.ipAddress)) on publicIpId\\r\\n| extend PublicIP = case(\\r\\n\\ttype =~ 'API Management', properties.publicIPAddresses,\\r\\n\\ttype =~ 'App Gateways', publicIpAddress,\\r\\n\\t' ')\\r\\n| extend Details = pack_all()\\r\\n| project Resource=id, type, subscriptionId, Sku, State, SiteCount, PublicIP, Details\",\"size\":2,\"noDataMessage\":\"No resources found\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"Resource\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Resource\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortCriteriaField\":\"type\",\"sortOrderField\":1}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"apps\"}],\"name\":\"query - PaaS - Apps Detailed\",\"styleSettings\":{\"padding\":\"0 0 200px 0\"}},{\"type\":1,\"content\":{\"json\":\"### NoShow - End PaaS - Apps\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow End PaaS - Apps\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - Begin PaaS - Events\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow Begin PaaS - Events\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type has 'microsoft.servicebus'\\r\\n\\tor type has 'microsoft.eventhub'\\r\\n\\tor type has 'microsoft.eventgrid'\\r\\n\\tor type has 'microsoft.relay'\\r\\n| extend type = case(\\r\\n\\ttype == 'microsoft.eventgrid/systemtopics', \\\"EventGrid System Topics\\\",\\r\\n\\ttype =~ \\\"microsoft.eventgrid/topics\\\", \\\"EventGrid Topics\\\",\\r\\n\\ttype =~ 'microsoft.eventhub/namespaces', \\\"EventHub Namespaces\\\",\\r\\n\\ttype =~ 'microsoft.servicebus/namespaces', 'ServiceBus Namespaces',\\r\\n\\ttype =~ 'microsoft.relay/namespaces', 'Relays',\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| where type !has \\\"Not Translated\\\"\\r\\n| summarize count() by type\",\"size\":1,\"noDataMessage\":\"No resources found\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"Resource\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Resource\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortCriteriaField\":\"type\",\"sortOrderField\":1}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"events\"}],\"name\":\"query - PaaS - Events Overview\"},{\"type\":1,\"content\":{\"json\":\"### Detailed View\\r\\n\\r\\nüí° select 'View Details' to see full return from Azure Resource Graph\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"events\"}],\"name\":\"text - PaaS Text - Events - Details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type has 'microsoft.servicebus'\\r\\n\\tor type has 'microsoft.eventhub'\\r\\n\\tor type has 'microsoft.eventgrid'\\r\\n\\tor type has 'microsoft.relay'\\r\\n| extend type = case(\\r\\n\\ttype == 'microsoft.eventgrid/systemtopics', \\\"EventGrid System Topics\\\",\\r\\n\\ttype =~ \\\"microsoft.eventgrid/topics\\\", \\\"EventGrid Topics\\\",\\r\\n\\ttype =~ 'microsoft.eventhub/namespaces', \\\"EventHub Namespaces\\\",\\r\\n\\ttype =~ 'microsoft.servicebus/namespaces', 'ServiceBus Namespaces',\\r\\n\\ttype =~ 'microsoft.relay/namespaces', 'Relays',\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| extend Sku = case(\\r\\n\\ttype =~ 'Relays', sku.name, \\r\\n\\ttype =~ 'EventGrid System Topics', properties.sku,\\r\\n\\ttype =~ 'EventGrid Topics', sku.name,\\r\\n\\ttype =~ 'EventHub Namespaces', sku.name,\\r\\n\\ttype =~ 'ServiceBus Namespaces', sku.sku,\\r\\n\\t' ')\\r\\n| extend Endpoint = case(\\r\\n\\ttype =~ 'Relays', properties.serviceBusEndpoint,\\r\\n\\ttype =~ 'EventGrid Topics', properties.endpoint,\\r\\n\\ttype =~ 'EventHub Namespaces', properties.serviceBusEndpoint,\\r\\n\\ttype =~ 'ServiceBus Namespaces', properties.serviceBusEndpoint,\\r\\n\\t' ')\\r\\n| extend Status = case(\\r\\n\\ttype =~ 'Relays', properties.provisioningState,\\r\\n\\ttype =~ 'EventGrid System Topics', properties.provisioningState,\\r\\n\\ttype =~ 'EventGrid Topics', properties.publicNetworkAccess,\\r\\n\\ttype =~ 'EventHub Namespaces', properties.status,\\r\\n\\ttype =~ 'ServiceBus Namespaces', properties.status,\\r\\n\\t' ')\\r\\n| extend Details = pack_all()\\r\\n| project Resource=id, type, subscriptionId, resourceGroup, Sku, Status, Endpoint, Details\",\"size\":2,\"noDataMessage\":\"No resources found\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"Resource\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Resource\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortCriteriaField\":\"type\",\"sortOrderField\":1}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"events\"}],\"name\":\"query - PaaS - Events Detailed\",\"styleSettings\":{\"padding\":\"0 0 200px 0\"}},{\"type\":1,\"content\":{\"json\":\"### NoShow - End PaaS - Events\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow End PaaS - Events\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - Begin PaaS - Data\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow Begin PaaS - Data\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources \\r\\n| where type has 'microsoft.documentdb'\\r\\n\\tor type has 'microsoft.sql'\\r\\n\\tor type has 'microsoft.dbformysql'\\r\\n\\tor type has 'microsoft.sql'\\r\\n    or type has 'microsoft.purview'\\r\\n    or type has 'microsoft.datafactory'\\r\\n\\tor type has 'microsoft.analysisservices'\\r\\n\\tor type has 'microsoft.datamigration'\\r\\n\\tor type has 'microsoft.synapse'\\r\\n\\tor type has 'microsoft.datafactory'\\r\\n\\tor type has 'microsoft.kusto'\\r\\n    or type has 'microsoft.dbforpostgresql'\\r\\n    or type has 'microsoft.digitaltwins'\\r\\n| extend type = case(\\r\\n\\ttype =~ 'microsoft.documentdb/databaseaccounts', 'CosmosDB',\\r\\n\\ttype =~ 'microsoft.sql/servers/databases', 'SQL DBs',\\r\\n\\ttype =~ 'microsoft.dbformysql/servers', 'MySQL',\\r\\n\\ttype =~ 'microsoft.sql/servers', 'SQL Servers',\\r\\n    type =~ 'microsoft.purview/accounts', 'Purview Accounts',\\r\\n\\ttype =~ 'microsoft.synapse/workspaces/sqlpools', 'Synapse SQL Pools',\\r\\n\\ttype =~ 'microsoft.kusto/clusters', 'ADX Clusters',\\r\\n\\ttype =~ 'microsoft.datafactory/factories', 'Data Factories',\\r\\n\\ttype =~ 'microsoft.synapse/workspaces', 'Synapse Workspaces',\\r\\n\\ttype =~ 'microsoft.analysisservices/servers', 'Analysis Services Servers',\\r\\n\\ttype =~ 'microsoft.datamigration/services', 'DB Migration Service',\\r\\n\\ttype =~ 'microsoft.sql/managedinstances/databases', 'Managed Instance DBs',\\r\\n\\ttype =~ 'microsoft.sql/managedinstances', 'Managed Instnace',\\r\\n\\ttype =~ 'microsoft.datamigration/services/projects', 'Data Migration Projects',\\r\\n\\ttype =~ 'microsoft.sql/virtualclusters', 'SQL Virtual Clusters',\\r\\n    type =~ 'microsoft.dbforpostgresql/servers', 'PostgreSQL DBs',\\r\\n    type =~ 'microsoft.digitaltwins/digitaltwinsinstances', 'Digital Twins',\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| where type !has \\\"Not Translated\\\"\\r\\n| summarize count() by type\",\"size\":1,\"noDataMessage\":\"No resources found\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"Resource\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Resource\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortCriteriaField\":\"type\",\"sortOrderField\":1}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"data\"}],\"name\":\"query - PaaS - Data Overview\"},{\"type\":1,\"content\":{\"json\":\"### Detailed View\\r\\n\\r\\nüí° select 'View Details' to see full return from Azure Resource Graph\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"data\"}],\"name\":\"text - PaaS Text - Data - Details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources \\r\\n| where type has 'microsoft.documentdb'\\r\\n\\tor type has 'microsoft.sql'\\r\\n\\tor type has 'microsoft.dbformysql'\\r\\n    or type has 'microsoft.purview'\\r\\n    or type has 'microsoft.datafactory'\\r\\n\\tor type has 'microsoft.analysisservices'\\r\\n\\tor type has 'microsoft.datamigration'\\r\\n\\tor type has 'microsoft.synapse'\\r\\n\\tor type has 'microsoft.datafactory'\\r\\n\\tor type has 'microsoft.kusto'\\r\\n    or type has 'microsoft.dbforpostgresql'\\r\\n    or type has 'microsoft.digitaltwins'\\r\\n| extend type = case(\\r\\n\\ttype =~ 'microsoft.documentdb/databaseaccounts', 'CosmosDB',\\r\\n\\ttype =~ 'microsoft.sql/servers/databases', 'SQL DBs',\\r\\n\\ttype =~ 'microsoft.dbformysql/servers', 'MySQL',\\r\\n\\ttype =~ 'microsoft.sql/servers', 'SQL Servers',\\r\\n    type =~ 'microsoft.purview/accounts', 'Purview Accounts',\\r\\n\\ttype =~ 'microsoft.synapse/workspaces/sqlpools', 'Synapse SQL Pools',\\r\\n\\ttype =~ 'microsoft.kusto/clusters', 'ADX Clusters',\\r\\n\\ttype =~ 'microsoft.datafactory/factories', 'Data Factories',\\r\\n\\ttype =~ 'microsoft.synapse/workspaces', 'Synapse Workspaces',\\r\\n\\ttype =~ 'microsoft.analysisservices/servers', 'Analysis Services Servers',\\r\\n\\ttype =~ 'microsoft.datamigration/services', 'DB Migration Service',\\r\\n\\ttype =~ 'microsoft.sql/managedinstances/databases', 'Managed Instance DBs',\\r\\n\\ttype =~ 'microsoft.sql/managedinstances', 'Managed Instnace',\\r\\n\\ttype =~ 'microsoft.datamigration/services/projects', 'Data Migration Projects',\\r\\n\\ttype =~ 'microsoft.sql/virtualclusters', 'SQL Virtual Clusters',\\r\\n    type =~ 'microsoft.dbforpostgresql/servers', 'PostgreSQL DBs',\\r\\n    type =~ 'microsoft.digitaltwins/digitaltwinsinstances', 'Digital Twins',\\r\\n    strcat(\\\"Not Translated: \\\", type))\\r\\n| where type !has \\\"Not Translated\\\"\\r\\n| extend Sku = case(\\r\\n\\ttype =~ 'CosmosDB', properties.databaseAccountOfferType,\\r\\n\\ttype =~ 'SQL DBs', iif(sku.name == \\\"Standard\\\",\\r\\n        strcat(sku.name, \\\" \\\", properties.requestedServiceObjectiveName, \\\" - \\\", sku.capacity)\\r\\n        , sku.name),\\r\\n\\ttype =~ 'MySQL', sku.name,\\r\\n\\ttype =~ 'ADX Clusters', sku.name,\\r\\n\\ttype =~ 'Purview Accounts', sku.name,\\r\\n    type =~ 'PostgreSQL DBs', strcat(sku.tier, ', ', sku.family),\\r\\n\\t' ')\\r\\n| extend Status = case(\\r\\n\\ttype =~ 'CosmosDB', properties.provisioningState,\\r\\n\\ttype =~ 'SQL DBs', properties.status,\\r\\n\\ttype =~ 'MySQL', properties.userVisibleState,\\r\\n\\ttype =~ 'Managed Instance DBs', properties.status,\\r\\n\\t' ')\\r\\n| extend Endpoint = case(\\r\\n\\ttype =~ 'MySQL', properties.fullyQualifiedDomainName,\\r\\n\\ttype =~ 'SQL Servers', properties.fullyQualifiedDomainName,\\r\\n\\ttype =~ 'CosmosDB', properties.documentEndpoint,\\r\\n\\ttype =~ 'ADX Clusters', properties.uri,\\r\\n\\ttype =~ 'Purview Accounts', properties.endpoints,\\r\\n\\ttype =~ 'Synapse Workspaces', properties.connectivityEndpoints,\\r\\n\\ttype =~ 'Synapse SQL Pools', sku.name,\\r\\n\\t' ')\\r\\n| extend Tier = sku.tier\\r\\n| extend License = properties.licenseType\\r\\n| extend maxSizeGB = todouble(case(\\r\\n\\ttype =~ 'SQL DBs', properties.maxSizeBytes,\\r\\n\\ttype =~ 'MySQL', properties.storageProfile.storageMB,\\r\\n\\ttype =~ 'Synapse SQL Pools', properties.maxSizeBytes,\\r\\n\\t' '))\\r\\n| extend maxSizeGB = case(\\r\\n\\t\\ttype has 'SQL DBs', maxSizeGB /1000 /1000 /1000,\\r\\n\\t\\ttype has 'Synapse SQL Pools', maxSizeGB /1000 /1000 /1000,\\r\\n\\t\\ttype has 'MySQL', maxSizeGB /1000,\\r\\n\\t\\tmaxSizeGB)\\r\\n| extend Details = pack_all()\\r\\n| project Resource=id, resourceGroup, subscriptionId, type, Sku, Tier, Status, Endpoint, maxSizeGB, Details\\r\\n\\r\\n\",\"size\":2,\"noDataMessage\":\"No resources found\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"Resource\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"Tier\",\"formatter\":1},{\"columnMatch\":\"maxSizeGB\",\"formatter\":0,\"numberFormat\":{\"unit\":5,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}}],\"rowLimit\":1000,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Resource\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortCriteriaField\":\"type\",\"sortOrderField\":1}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"data\"}],\"name\":\"query - PaaS - Data Detailed\",\"styleSettings\":{\"padding\":\"0 0 200px 0\"}},{\"type\":1,\"content\":{\"json\":\"### NoShow - End PaaS - Data\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow End PaaS - Data\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - Begin PaaS - Storage\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow Begin PaaS - Storage\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources \\r\\n| where type =~ 'microsoft.storagesync/storagesyncservices'\\r\\n\\tor type =~ 'microsoft.recoveryservices/vaults'\\r\\n\\tor type =~ 'microsoft.storage/storageaccounts'\\r\\n\\tor type =~ 'microsoft.keyvault/vaults'\\r\\n| extend type = case(\\r\\n\\ttype =~ 'microsoft.storagesync/storagesyncservices', 'Azure File Sync',\\r\\n\\ttype =~ 'microsoft.recoveryservices/vaults', 'Azure Backup',\\r\\n\\ttype =~ 'microsoft.storage/storageaccounts', 'Storage Accounts',\\r\\n\\ttype =~ 'microsoft.keyvault/vaults', 'Key Vaults',\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| where type !has \\\"Not Translated\\\"\\r\\n| summarize count() by type\",\"size\":1,\"noDataMessage\":\"No resources found\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"Resource\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Resource\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortCriteriaField\":\"type\",\"sortOrderField\":1}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"storage\"}],\"name\":\"query - PaaS - Data Overview \"},{\"type\":1,\"content\":{\"json\":\"### Detailed View\\r\\n\\r\\nüí° select 'View Details' to see full return from Azure Resource Graph\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"storage\"}],\"name\":\"text - PaaS Text - Storage - Details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources \\r\\n| where type =~ 'microsoft.storagesync/storagesyncservices'\\r\\n\\tor type =~ 'microsoft.recoveryservices/vaults'\\r\\n\\tor type =~ 'microsoft.storage/storageaccounts'\\r\\n\\tor type =~ 'microsoft.keyvault/vaults'\\r\\n| extend type = case(\\r\\n\\ttype =~ 'microsoft.storagesync/storagesyncservices', 'Azure File Sync',\\r\\n\\ttype =~ 'microsoft.recoveryservices/vaults', 'Azure Backup',\\r\\n\\ttype =~ 'microsoft.storage/storageaccounts', 'Storage Accounts',\\r\\n\\ttype =~ 'microsoft.keyvault/vaults', 'Key Vaults',\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| extend Sku = case(\\r\\n\\ttype !has 'Key Vaults', sku.name,\\r\\n\\ttype =~ 'Key Vaults', properties.sku.name,\\r\\n\\t' ')\\r\\n| extend Details = pack_all()\\r\\n| project Resource=id, type, kind, subscriptionId, resourceGroup, Sku, Details\",\"size\":2,\"noDataMessage\":\"No resources found\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"Resource\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Resource\"}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"storage\"}],\"name\":\"query - PaaS - Data Detailed\",\"styleSettings\":{\"padding\":\"0 0 200px 0\"}},{\"type\":1,\"content\":{\"json\":\"### NoShow - End PaaS - Storage\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow End PaaS - Storage - Copy\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - Begin PaaS - Containers\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow Begin PaaS - Containers\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type =~ 'microsoft.containerservice/managedclusters'\\r\\n\\tor type =~ 'microsoft.containerregistry/registries'\\r\\n\\tor type =~ 'microsoft.containerinstance/containergroups'\\r\\n| extend type = case(\\r\\n\\ttype =~ 'microsoft.containerservice/managedclusters', 'AKS',\\r\\n\\ttype =~ 'microsoft.containerregistry/registries', 'Container Registry',\\r\\n\\ttype =~ 'microsoft.containerinstance/containergroups', 'Container Instnaces',\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| where type !has \\\"Not Translated\\\"\\r\\n| summarize count() by type\\t\",\"size\":1,\"noDataMessage\":\"No Container resources found\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"Resource\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Resource\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortCriteriaField\":\"type\",\"sortOrderField\":1}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"containers\"}],\"name\":\"query - PaaS - Containers Overview\"},{\"type\":1,\"content\":{\"json\":\"### Detailed View\\r\\n\\r\\nüí° select 'View Details' to see full return from Azure Resource Graph\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"containers\"}],\"name\":\"text - PaaS Text - Containers - Details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type =~ 'microsoft.containerservice/managedclusters'\\r\\n\\tor type =~ 'microsoft.containerregistry/registries'\\r\\n\\tor type =~ 'microsoft.containerinstance/containergroups'\\r\\n| extend type = case(\\r\\n\\ttype =~ 'microsoft.containerservice/managedclusters', 'AKS',\\r\\n\\ttype =~ 'microsoft.containerregistry/registries', 'Container Registry',\\r\\n\\ttype =~ 'microsoft.containerinstance/containergroups', 'Container Instnaces',\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| where type !has \\\"Not Translated\\\"\\r\\n| extend Tier = sku.tier\\r\\n| extend sku = sku.name\\r\\n| extend State = case(\\r\\n\\ttype =~ 'Container Registry', properties.provisioningState,\\r\\n\\ttype =~ 'Container Instance', properties.instanceView.state,\\r\\n\\tproperties.powerState.code)\\r\\n| extend Containers = properties.containers\\r\\n| mvexpand Containers\\r\\n| extend RestartCount = Containers.properties.instanceView.restartCount\\r\\n| extend Image = Containers.properties.image\\r\\n| extend RestartPolicy = properties.restartPolicy\\r\\n| extend IP = properties.ipAddress.ip\\r\\n| extend Version = properties.kubernetesVersion\\r\\n| extend AgentProfiles = properties.agentPoolProfiles\\r\\n| mvexpand AgentProfiles\\r\\n| extend NodeCount = AgentProfiles.[\\\"count\\\"]\\r\\n| extend Details = pack_all()\\r\\n| project id, type, location, resourceGroup, subscriptionId, sku, Tier, State, RestartCount, Version, NodeCount, Details\",\"size\":2,\"noDataMessage\":\"No Container resources found\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"sku\",\"formatter\":1},{\"columnMatch\":\"Tier\",\"formatter\":1},{\"columnMatch\":\"State\",\"formatter\":1},{\"columnMatch\":\"RestartCount\",\"formatter\":1},{\"columnMatch\":\"Version\",\"formatter\":1},{\"columnMatch\":\"NodeCount\",\"formatter\":1},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"Resource\",\"formatter\":5}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"id\"}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"containers\"}],\"name\":\"query - PaaS - Containers Detailed \",\"styleSettings\":{\"padding\":\"0 0 200px 0\"}},{\"type\":1,\"content\":{\"json\":\"### NoShow - End PaaS - Containers\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow End PaaS - Containers\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - Begin PaaS - ML/AI\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow Begin PaaS - ML/AI\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type =~ 'Microsoft.MachineLearningServices/workspaces'\\r\\n\\tor type =~ 'microsoft.cognitiveservices/accounts'\\r\\n| extend type = case(\\r\\n\\ttype =~ 'Microsoft.MachineLearningServices/workspaces', 'ML Workspaces',\\r\\n\\ttype =~ 'microsoft.cognitiveservices/accounts', 'Cognitive Services',\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| where type !has \\\"Not Translated\\\"\\r\\n| summarize count() by type\\t\",\"size\":1,\"noDataMessage\":\"No ML/AI resources found\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"Resource\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Resource\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortCriteriaField\":\"type\",\"sortOrderField\":1}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"mlai\"}],\"name\":\"query - PaaS - MLAI Overview\"},{\"type\":1,\"content\":{\"json\":\"### Detailed View\\r\\n\\r\\nüí° select 'View Details' to see full return from Azure Resource Graph\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"mlai\"}],\"name\":\"text - PaaS Text - ML/AI - Details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type =~ 'Microsoft.MachineLearningServices/workspaces'\\r\\n\\tor type =~ 'microsoft.cognitiveservices/accounts'\\r\\n| extend type = case(\\r\\n\\ttype =~ 'Microsoft.MachineLearningServices/workspaces', 'ML Workspaces',\\r\\n\\ttype =~ 'microsoft.cognitiveservices/accounts', 'Cognitive Services',\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| where type !has \\\"Not Translated\\\"\\r\\n| extend Tier = sku.tier\\r\\n| extend sku = sku.name\\r\\n| extend Endpoint = case(\\r\\n\\ttype =~ 'ML Workspaces', properties.discoveryUrl,\\r\\n\\ttype =~ 'Cognitive Services', properties.endpoint,\\r\\n\\t' ')\\r\\n| extend Capabilities = properties.capabilities\\r\\n| mvexpand Capabilities\\r\\n| extend Capabilities.value\\r\\n| extend Storage = properties.storageAccount\\r\\n| extend AppInsights = properties.applicationInsights\\r\\n| extend Details = pack_all()\\r\\n| project id, type, location, resourceGroup, subscriptionId, sku, Tier, Endpoint, Capabilities_value, Storage, AppInsights, Details\",\"size\":2,\"noDataMessage\":\"No ML/AI resources found\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"sku\",\"formatter\":1},{\"columnMatch\":\"Tier\",\"formatter\":1},{\"columnMatch\":\"Capabilities_value\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"Storage\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"AppInsights\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"State\",\"formatter\":1},{\"columnMatch\":\"RestartCount\",\"formatter\":1},{\"columnMatch\":\"Version\",\"formatter\":1},{\"columnMatch\":\"NodeCount\",\"formatter\":1},{\"columnMatch\":\"Resource\",\"formatter\":5}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"id\"}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"mlai\"}],\"name\":\"query - PaaS - MLAI Detailed \",\"styleSettings\":{\"padding\":\"0 0 200px 0\"}},{\"type\":1,\"content\":{\"json\":\"### NoShow - End PaaS - ML/AI\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow End PaaS - ML/AI\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - Begin PaaS - IoT\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow Begin PaaS - IoT\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type =~ 'microsoft.devices/iothubs'\\r\\n\\tor type =~ 'microsoft.iotcentral/iotapps'\\r\\n\\tor type =~ 'microsoft.security/iotsecuritysolutions'\\r\\n| extend type = case (\\r\\n\\ttype =~ 'microsoft.devices/iothubs', 'IoT Hubs',\\r\\n\\ttype =~ 'microsoft.iotcentral/iotapps', 'IoT Apps',\\r\\n\\ttype =~ 'microsoft.security/iotsecuritysolutions', 'IoT Security',\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| summarize count() by type\",\"size\":1,\"noDataMessage\":\"No IoT resources found\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"Resource\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Resource\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortCriteriaField\":\"type\",\"sortOrderField\":1}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"iot\"}],\"name\":\"query - PaaS - IoT Overview\"},{\"type\":1,\"content\":{\"json\":\"### Detailed View\\r\\n\\r\\nüí° select 'View Details' to see full return from Azure Resource Graph\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"iot\"}],\"name\":\"text - PaaS Text - IoT - Details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type =~ 'microsoft.devices/iothubs'\\r\\n\\tor type =~ 'microsoft.iotcentral/iotapps'\\r\\n\\tor type =~ 'microsoft.security/iotsecuritysolutions'\\r\\n| extend type = case (\\r\\n\\ttype =~ 'microsoft.devices/iothubs', 'IoT Hubs',\\r\\n\\ttype =~ 'microsoft.iotcentral/iotapps', 'IoT Apps',\\r\\n\\ttype =~ 'microsoft.security/iotsecuritysolutions', 'IoT Security',\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| extend Tier = sku.tier\\r\\n| extend sku = sku.name\\r\\n| extend State = properties.state\\r\\n| extend HostName = properties.hostName\\r\\n| extend EventHubEndPoint = properties.eventHubEndpoints.events.endpoint\\r\\n| extend Details = pack_all()\\r\\n| project id, type, location, resourceGroup, subscriptionId, sku, Tier, State, HostName, EventHubEndPoint, Details\",\"size\":2,\"noDataMessage\":\"No IoT resources found\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"sku\",\"formatter\":1},{\"columnMatch\":\"Tier\",\"formatter\":1},{\"columnMatch\":\"Capabilities_value\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkIsContextBlade\":true,\"customColumnWidthSetting\":\"20ch\"}},{\"columnMatch\":\"Storage\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"AppInsights\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"State\",\"formatter\":1},{\"columnMatch\":\"RestartCount\",\"formatter\":1},{\"columnMatch\":\"Version\",\"formatter\":1},{\"columnMatch\":\"NodeCount\",\"formatter\":1},{\"columnMatch\":\"Resource\",\"formatter\":5}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"id\"}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"iot\"}],\"name\":\"query - PaaS - IoT Detailed \",\"styleSettings\":{\"padding\":\"0 0 200px 0\"}},{\"type\":1,\"content\":{\"json\":\"### NoShow - End PaaS - IoT\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow End PaaS - IoT\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - Begin PaaS - WVD\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow Begin PaaS - WVD - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type has 'microsoft.desktopvirtualization'\\r\\n| extend type = case(\\r\\n\\ttype =~ 'microsoft.desktopvirtualization/applicationgroups', 'WVD App Groups',\\r\\n\\ttype =~ 'microsoft.desktopvirtualization/hostpools', 'WVD Host Pools',\\r\\n\\ttype =~ 'microsoft.desktopvirtualization/workspaces', 'WVD Workspaces',\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| where type !has \\\"Not Translated\\\"\\r\\n| summarize count() by type\",\"size\":1,\"noDataMessage\":\"No WVD Resources found\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"Resource\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5}],\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Resource\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortCriteriaField\":\"type\",\"sortOrderField\":1}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"wvd\"}],\"name\":\"query - PaaS - WVD Overview \"},{\"type\":1,\"content\":{\"json\":\"### Detailed View\\r\\n\\r\\nüí° select 'View Details' to see full return from Azure Resource Graph\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"wvd\"}],\"name\":\"text - PaaS Text - WVD - Details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type has 'microsoft.desktopvirtualization'\\r\\n| extend type = case(\\r\\n\\ttype =~ 'microsoft.desktopvirtualization/applicationgroups', 'WVD App Groups',\\r\\n\\ttype =~ 'microsoft.desktopvirtualization/hostpools', 'WVD Host Pools',\\r\\n\\ttype =~ 'microsoft.desktopvirtualization/workspaces', 'WVD Workspaces',\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| where type !has \\\"Not Translated\\\"\\r\\n| extend Details = pack_all()\\r\\n| project id, type, resourceGroup, subscriptionId, kind, location, Details\",\"size\":2,\"noDataMessage\":\"No WVD resources found\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"Resource\",\"formatter\":5},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"id\"}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"paas\"},{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"wvd\"}],\"name\":\"query - PaaS - WVD Detailed\",\"styleSettings\":{\"padding\":\"0 0 200px 0\"}},{\"type\":1,\"content\":{\"json\":\"### NoShow - End PaaS - WVD\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow End PaaS - WVD - Copy\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type has 'microsoft.sql/Servers'\\r\\n    or type has 'microsoft.sql/servers/Databases'\\r\\n| extend type = case(\\r\\n\\r\\n    type =~ 'microsoft.sql/servers', 'SQL Servers',\\r\\n    type =~ 'microsoft.sql/servers/databases', 'SQL Databases',\\r\\nstrcat(\\\"Not Translated: \\\", type))\\r\\n| summarize count() by type\\r\\n| where type !has \\\"Not Translated\\\"\",\"size\":4,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"],\"visualization\":\"tiles\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"conditionalVisibility\":{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"sql\"},\"name\":\"query - 126\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Resources\\r\\n\\r\\n | where type == 'microsoft.sql/servers/databases'\\r\\n | where name != 'master'\\r\\n | project Database = id,\\r\\n   [\\\"Elastic Pool\\\"] = tostring(properties.elasticPoolId),\\r\\n   [\\\"SKU Name\\\"] = sku.name,\\r\\n   [\\\"Pricing Tier\\\"] = sku.tier,\\r\\n   Status = properties.status\\r\\n\",\"size\":0,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"]},\"conditionalVisibility\":{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"sql\"},\"name\":\"query - 125\"}]},\"conditionalVisibility\":{\"parameterName\":\"paas\",\"comparison\":\"isEqualTo\",\"value\":\"sql\"},\"name\":\"group - 134\"},{\"type\":1,\"content\":{\"json\":\"## End PaaS\\r\\n\\r\\n\\r\\n## Begin Networking\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow Monitoring Security\"},{\"type\":1,\"content\":{\"json\":\"## Networking Overview\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"network\"},\"name\":\"text - Networking Overview\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"where type has \\\"microsoft.network\\\"\\r\\n    or type has 'microsoft.cdn'\\r\\n| extend type = case(\\r\\n\\ttype == 'microsoft.network/networkinterfaces', \\\"NICs\\\",\\r\\n\\ttype == 'microsoft.network/networksecuritygroups', \\\"NSGs\\\", \\r\\n\\ttype == \\\"microsoft.network/publicipaddresses\\\", \\\"Public IPs\\\", \\r\\n\\ttype == 'microsoft.network/virtualnetworks', \\\"vNets\\\",\\r\\n\\ttype == 'microsoft.network/networkwatchers/connectionmonitors', \\\"Connection Monitors\\\",\\r\\n\\ttype == 'microsoft.network/privatednszones', \\\"Private DNS\\\",\\r\\n\\ttype == 'microsoft.network/virtualnetworkgateways', @\\\"vNet Gateways\\\",\\r\\n\\ttype == 'microsoft.network/connections', \\\"Connections\\\",\\r\\n\\ttype == 'microsoft.network/networkwatchers', \\\"Network Watchers\\\",\\r\\n\\ttype == 'microsoft.network/privateendpoints', \\\"Private Endpoints\\\",\\r\\n\\ttype == 'microsoft.network/localnetworkgateways', \\\"Local Network Gateways\\\",\\r\\n\\ttype == 'microsoft.network/privatednszones/virtualnetworklinks', \\\"vNet Links\\\",\\r\\n\\ttype == 'microsoft.network/dnszones', 'DNS Zones',\\r\\n\\ttype == 'microsoft.network/networkwatchers/flowlogs', 'Flow Logs',\\r\\n\\ttype == 'microsoft.network/routetables', 'Route Tables',\\r\\n\\ttype == 'microsoft.network/loadbalancers', 'Load Balancers',\\r\\n\\ttype == 'microsoft.network/ddosprotectionplans', 'DDoS Protection Plans',\\r\\n\\ttype == 'microsoft.network/applicationsecuritygroups', 'App Security Groups',\\r\\n\\ttype == 'microsoft.network/azurefirewalls', 'Azure Firewalls',\\r\\n\\ttype == 'microsoft.network/applicationgateways', 'App Gateways',\\r\\n\\ttype == 'microsoft.network/frontdoors', 'Front Doors',\\r\\n\\ttype == 'microsoft.network/applicationgatewaywebapplicationfirewallpolicies', 'AppGateway Policies',\\r\\n\\ttype == 'microsoft.network/bastionhosts', 'Bastion Hosts',\\r\\n\\ttype == 'microsoft.network/frontdoorwebapplicationfirewallpolicies', 'FrontDoor Policies',\\r\\n\\ttype == 'microsoft.network/firewallpolicies', 'Firewall Policies',\\r\\n\\ttype == 'microsoft.network/networkintentpolicies', 'Network Intent Policies',\\r\\n\\ttype == 'microsoft.network/trafficmanagerprofiles', 'Traffic Manager Profiles',\\r\\n\\ttype == 'microsoft.network/publicipprefixes', 'PublicIP Prefixes',\\r\\n\\ttype == 'microsoft.network/privatelinkservices', 'Private Link',\\r\\n\\ttype == 'microsoft.network/expressroutecircuits', 'Express Route Circuits',\\r\\n\\ttype =~ 'microsoft.cdn/cdnwebapplicationfirewallpolicies', 'CDN Web App Firewall Policies',\\r\\n\\ttype =~ 'microsoft.cdn/profiles', 'CDN Profiles',\\r\\n\\ttype =~ 'microsoft.cdn/profiles/afdendpoints', 'CDN Front Door Endpoints',\\r\\n\\ttype =~ 'microsoft.cdn/profiles/endpoints', 'CDN Endpoints',\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| summarize count() by type\",\"size\":2,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortCriteriaField\":\"count_\",\"sortOrderField\":2}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"network\"},\"name\":\"query - Networking Summary\"},{\"type\":1,\"content\":{\"json\":\"## Networking Details\\r\\n\\r\\nüí° select tab to view NSG Details\\r\\n\\r\\nüí° select 'View Details' to see full return from Azure Resource Graph\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"network\"},\"name\":\"text - Neworking Details\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"5e8a9d46-8041-44fe-96a2-3a606143b199\",\"cellValue\":\"network\",\"linkTarget\":\"parameter\",\"linkLabel\":\"NSG\",\"subTarget\":\"nsg\",\"style\":\"link\"},{\"id\":\"11426c5c-1edb-41a5-bb7f-fbfb8bbc4bba\",\"cellValue\":\"network\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Unassociated NSGs\",\"subTarget\":\"blanknsgs\",\"style\":\"link\"},{\"id\":\"5c167305-3eff-4612-a28a-8be527307914\",\"cellValue\":\"network\",\"linkTarget\":\"parameter\",\"linkLabel\":\"NSG Rules\",\"subTarget\":\"nsgrules\",\"style\":\"link\"},{\"id\":\"7c7ca1a8-c880-443b-aa48-ad0b7ad11aa4\",\"cellValue\":\"network\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Public IP Addresses\",\"subTarget\":\"pips\",\"style\":\"link\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"network\"},\"name\":\"links - Networking Details - Tabs\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Public IP Addresses\",\"items\":[{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"997c84bc-c454-47f7-a288-99429173dfeb\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Subscription\",\"type\":6,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"value\":[\"/subscriptions/03648514-5be8-4be8-ba64-cfaa241b2448\"],\"typeSettings\":{\"additionalResourceOptions\":[],\"includeAll\":false}},{\"id\":\"73638b3d-aa3f-4872-a56b-a0eaf3fc7714\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"isRequired\":true,\"query\":\"Resources | where type =~ \\\"microsoft.operationalinsights/workspaces\\\" | order by name | project id, name, selected=row_number()==1, group=resourceGroup\",\"crossComponentResources\":[\"{Subscription}\"],\"typeSettings\":{\"additionalResourceOptions\":[]},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"value\":\"/subscriptions/03648514-5be8-4be8-ba64-cfaa241b2448/resourceGroups/Azure-Sentinel-RG/providers/Microsoft.OperationalInsights/workspaces/LuckAzureSentinel\"},{\"id\":\"86b1f0f2-a800-4330-9573-44dcb7f765fe\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"value\":{\"durationMs\":2592000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":300000},{\"durationMs\":900000},{\"durationMs\":1800000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2419200000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true}}],\"style\":\"above\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"94335345-761a-4e21-9a1f-9ed8307bf07e\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Network\",\"subTarget\":\"Network\",\"style\":\"link\"},{\"id\":\"b5077da7-6376-430d-b3de-4a1a2c488002\",\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Computer\",\"subTarget\":\"Computer\",\"style\":\"link\"}]},\"name\":\"links - 6\"},{\"type\":1,\"content\":{\"json\":\"Author: Clive Watson (Microsoft)\\r\\nhttps://github.com/clivewatson/KQLpublic\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Change Log\"},\"name\":\"text - 4\"},{\"type\":1,\"content\":{\"json\":\"Overview\\r\\n\\r\\n##### Network Tab\\r\\nUse this Workbook to compare any Public IP address (PIP) in Azure Montor Logs and Azure Resource Graph (ARG).\\r\\nARG can have more data that is useful to compare logged data against.  \\r\\n\\t- e.g. If you create a Resource but never start it, ARG will have data, whereas Log Analytics wont have a log entry.  \\r\\n\\t- Also Log Analytics has data retention, so the data you seek may have been removed if the retention period has passed.\\r\\n\\r\\nData Source required:\\r\\n\\r\\n\\tAzureActivity\\r\\n\\t| where ResourceProvider == \\\"Microsoft.Network\\\"\\r\\n\\r\\nPermission: Access to ARG \\r\\n\\r\\n##### Computer Tab\\r\\nUse this tab to show show NSG and Computer realtionship, along with Public and Private IP and other settings, such as ports and traffic direction.\\r\\nnote: only Subscription(s) are required to be selected, as this is purely ARG based queries.\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - Help text\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Public IP Query group\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type == \\\"microsoft.network/publicipaddresses\\\"\\r\\n| summarize count() by subscriptionId, resourceGroup\\r\\n, publicIPAllocationMethod = tostring(properties.publicIPAllocationMethod), name, tostring(properties.ipAddress)\\r\\n, tostring(properties.provisioningState)\\r\\n, tostring(properties.publicIPAddressVersion)\",\"size\":1,\"title\":\"ARG for: {Subscription:name}\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"subscriptionId\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":null}},{\"columnMatch\":\"publicIPAllocationMethod\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"!=\",\"thresholdValue\":\"Dynamic\",\"representation\":\"more\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Normal\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"name\",\"formatter\":16,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"properties_provisioningState\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"success\",\"text\":\"{0}{1}\"}]}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"$gen_resourceType_name_3\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"$gen_resourceType_name_3\",\"sortOrder\":2}]},\"name\":\"query - grid ARG\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where properties matches regex @'[12]\\\\d\\\\d(\\\\.([1-9]?\\\\d|[12]\\\\d\\\\d)){3}'\\r\\n|project  name, type, location, resourceGroup, subscriptionId, properties\\r\\n\",\"size\":0,\"title\":\"All IP Address Related Activity\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"]},\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AzureActivity\\r\\n| where ResourceProvider == \\\"Microsoft.Network\\\"\\r\\n| where OperationName == \\\"Create or Update Public Ip Address\\\"\\r\\n| extend provisioningState_ = tostring(parse_json(tostring(parse_json(tostring(parse_json(Properties).responseBody)).properties)).provisioningState)\\r\\n| extend PIPaddress_ = tostring(parse_json(tostring(parse_json(tostring(parse_json(Properties).responseBody)).properties)).ipAddress)\\r\\n| extend name_ = tostring(parse_json(tostring(parse_json(Properties).responseBody)).name)\\r\\n| where ActivityStatus in (\\\"Accepted\\\",\\\"Succeeded\\\")\\r\\n| summarize by bin(TimeGenerated,{TimeRange:grain} ), SubscriptionId, ResourceGroup=toupper(ResourceGroup), Caller, Category, name_, PIPaddress_ ,  provisioningState_, ResourceProvider\\r\\n| sort by TimeGenerated desc \\r\\n\",\"size\":1,\"title\":\"KQL: AzureActivity for: {Subscription:name} and {Workspace:name}  \",\"noDataMessage\":\"no saved queries found in {Workspace:name}\",\"timeContextFromParameter\":\"TimeRange\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeGenerated\",\"formatter\":1},{\"columnMatch\":\"SubscriptionId\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":null}},{\"columnMatch\":\"Resource\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"Caller\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"Category\",\"formatter\":5},{\"columnMatch\":\"provisioningState_\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Succeeded\",\"representation\":\"success\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"Updating\",\"representation\":\"pending\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Blank\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Name\",\"formatter\":5},{\"columnMatch\":\"query\",\"formatter\":5}],\"rowLimit\":1000,\"filter\":true,\"sortBy\":[{\"itemKey\":\"$gen_link_SubscriptionId_1\",\"sortOrder\":2}],\"labelSettings\":[{\"columnId\":\"name_\",\"label\":\"Resource Name\"}]},\"sortBy\":[{\"itemKey\":\"$gen_link_SubscriptionId_1\",\"sortOrder\":2}]},\"conditionalVisibilities\":[{\"parameterName\":\"Subscription\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"Workspace\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"saved query grid\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"158cf2c4-6a48-4777-8004-0664ef5e4de7\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Show\",\"label\":\"Show More details\",\"type\":10,\"description\":\"When you select \\\"Yes\\\", this control will show rows with an empty IP Addresses to aid diagnostics  \",\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[]},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\", \\\"selected\\\":true},\\r\\n {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\" }\\r\\n]\",\"timeContext\":{\"durationMs\":86400000},\"value\":\"No\"}],\"style\":\"formHorizontal\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AzureActivity\\r\\n| where ResourceProvider == \\\"Microsoft.Network\\\"\\r\\n| where OperationName == \\\"Create or Update Public Ip Address\\\"\\r\\n| extend provisioningState_ = tostring(parse_json(tostring(parse_json(tostring(parse_json(Properties).responseBody)).properties)).provisioningState)\\r\\n| extend PIPaddress_ = tostring(parse_json(tostring(parse_json(tostring(parse_json(Properties).responseBody)).properties)).ipAddress)\\r\\n| extend name_ = tostring(parse_json(tostring(parse_json(Properties).responseBody)).name)\\r\\n| where ActivityStatus in (\\\"Accepted\\\",\\\"Succeeded\\\")\\r\\n| summarize count() by bin(TimeGenerated,{TimeRange:grain} ),  ResourceGroup=toupper(ResourceGroup), Caller, Category, name_, PIPaddress_ ,  provisioningState_\\r\\n| sort by TimeGenerated desc \\r\\n\\r\\n\",\"size\":1,\"title\":\"KQL: AzureActivity - timebrush enabled üìÖ\",\"noDataMessage\":\"no saved queries found in {Workspace:name}\",\"timeContextFromParameter\":\"TimeRange\",\"timeBrushParameterName\":\"TBkqlgraph\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"barchart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Category\",\"formatter\":5},{\"columnMatch\":\"Name\",\"formatter\":5},{\"columnMatch\":\"query\",\"formatter\":5}],\"rowLimit\":1000,\"filter\":true},\"sortBy\":[]},\"customWidth\":\"50\",\"conditionalVisibilities\":[{\"parameterName\":\"Subscription\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"Workspace\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"saved query grid - graph\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AzureActivity\\r\\n| where ResourceProvider == \\\"Microsoft.Network\\\"\\r\\n| where OperationName == \\\"Create or Update Public Ip Address\\\"\\r\\n| extend provisioningState_ = tostring(parse_json(tostring(parse_json(tostring(parse_json(Properties).responseBody)).properties)).provisioningState)\\r\\n| extend PIPaddress_ = tostring(parse_json(tostring(parse_json(tostring(parse_json(Properties).responseBody)).properties)).ipAddress)\\r\\n| extend name_ = tostring(parse_json(tostring(parse_json(Properties).responseBody)).name)\\r\\n| where ActivityStatus in (\\\"Accepted\\\",\\\"Succeeded\\\")\\r\\n| where isnotempty(PIPaddress_) \\r\\n| summarize by bin(TimeGenerated,{TimeRange:grain} ), SubscriptionId, ResourceGroup=toupper(ResourceGroup), Caller, Category, name_, PIPaddress_ ,  provisioningState_\\r\\n| sort by TimeGenerated desc \\r\\n\\r\\n\",\"size\":1,\"title\":\"KQL: AzureActivity - {TBkqlgraph:label} - filtered result of the timebrush üìÖ\",\"noDataMessage\":\"no saved queries found in {Workspace:name}\",\"timeContextFromParameter\":\"TBkqlgraph\",\"timeBrushParameterName\":\"TBkqlgraph\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeGenerated\",\"formatter\":1},{\"columnMatch\":\"SubscriptionId\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":null}},{\"columnMatch\":\"ResourceGroup\",\"formatter\":14,\"formatOptions\":{\"linkTarget\":null}},{\"columnMatch\":\"Category\",\"formatter\":5},{\"columnMatch\":\"Name\",\"formatter\":5},{\"columnMatch\":\"query\",\"formatter\":5}],\"rowLimit\":1000,\"filter\":true,\"sortBy\":[{\"itemKey\":\"PIPaddress_\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"PIPaddress_\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"conditionalVisibilities\":[{\"parameterName\":\"Subscription\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"Workspace\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"Show\",\"comparison\":\"isEqualTo\",\"value\":\"No\"}],\"name\":\"saved query grid - IP info only\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// can show rows Without an IP address \\r\\nAzureActivity\\r\\n| where ResourceProvider == \\\"Microsoft.Network\\\"\\r\\n| where OperationName == \\\"Create or Update Public Ip Address\\\"\\r\\n| extend provisioningState_ = tostring(parse_json(tostring(parse_json(tostring(parse_json(Properties).responseBody)).properties)).provisioningState)\\r\\n| extend PIPaddress_ = tostring(parse_json(tostring(parse_json(tostring(parse_json(Properties).responseBody)).properties)).ipAddress)\\r\\n| extend name_ = tostring(parse_json(tostring(parse_json(Properties).responseBody)).name)\\r\\n| where ActivityStatus in (\\\"Accepted\\\",\\\"Succeeded\\\")\\r\\n| summarize by bin(TimeGenerated,{TimeRange:grain} ), SubscriptionId, ResourceGroup=toupper(ResourceGroup), Caller, Category, name_, PIPaddress_ ,  provisioningState_\\r\\n| sort by TimeGenerated desc \\r\\n\\r\\n\",\"size\":1,\"title\":\"KQL: AzureActivity - {TBkqlgraph:label} - filtered result of the timebrush üìÖ\",\"noDataMessage\":\"no saved queries found in {Workspace:name}\",\"timeContextFromParameter\":\"TBkqlgraph\",\"timeBrushParameterName\":\"TBkqlgraph\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeGenerated\",\"formatter\":1},{\"columnMatch\":\"SubscriptionId\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":null}},{\"columnMatch\":\"ResourceGroup\",\"formatter\":14,\"formatOptions\":{\"linkTarget\":null}},{\"columnMatch\":\"Category\",\"formatter\":5},{\"columnMatch\":\"Name\",\"formatter\":5},{\"columnMatch\":\"query\",\"formatter\":5}],\"rowLimit\":1000,\"filter\":true,\"sortBy\":[{\"itemKey\":\"PIPaddress_\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"PIPaddress_\",\"sortOrder\":2}]},\"customWidth\":\"50\",\"conditionalVisibilities\":[{\"parameterName\":\"Subscription\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"Workspace\",\"comparison\":\"isNotEqualTo\"},{\"parameterName\":\"Show\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"}],\"name\":\"saved query grid - IP info inc blanks\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"{\\\"version\\\":\\\"Merge/1.0\\\",\\\"merges\\\":[{\\\"id\\\":\\\"a380f406-d151-4823-bfb4-e5e91270631c\\\",\\\"mergeType\\\":\\\"rightanti\\\",\\\"leftTable\\\":\\\"saved query grid\\\",\\\"rightTable\\\":\\\"query - grid ARG\\\",\\\"leftColumn\\\":\\\"name_\\\",\\\"rightColumn\\\":\\\"name\\\"}],\\\"projectRename\\\":[{\\\"originalName\\\":\\\"[saved query grid].Column1\\\",\\\"mergedName\\\":\\\"Column1\\\",\\\"fromId\\\":\\\"unknown\\\"},{\\\"originalName\\\":\\\"[query - grid ARG].subscriptionId\\\",\\\"mergedName\\\":\\\"subscriptionId\\\",\\\"fromId\\\":\\\"a380f406-d151-4823-bfb4-e5e91270631c\\\"},{\\\"originalName\\\":\\\"[query - grid ARG].resourceGroup\\\",\\\"mergedName\\\":\\\"resourceGroup\\\",\\\"fromId\\\":\\\"a380f406-d151-4823-bfb4-e5e91270631c\\\"},{\\\"originalName\\\":\\\"[query - grid ARG].publicIPAllocationMethod\\\",\\\"mergedName\\\":\\\"publicIPAllocationMethod\\\",\\\"fromId\\\":\\\"a380f406-d151-4823-bfb4-e5e91270631c\\\"},{\\\"originalName\\\":\\\"[query - grid ARG].name\\\",\\\"mergedName\\\":\\\"name\\\",\\\"fromId\\\":\\\"a380f406-d151-4823-bfb4-e5e91270631c\\\"},{\\\"originalName\\\":\\\"[query - grid ARG].properties_ipAddress\\\",\\\"mergedName\\\":\\\"properties_ipAddress\\\",\\\"fromId\\\":\\\"a380f406-d151-4823-bfb4-e5e91270631c\\\"},{\\\"originalName\\\":\\\"[query - grid ARG].properties_provisioningState\\\",\\\"mergedName\\\":\\\"properties_provisioningState\\\",\\\"fromId\\\":\\\"a380f406-d151-4823-bfb4-e5e91270631c\\\"},{\\\"originalName\\\":\\\"[query - grid ARG].properties_publicIPAddressVersion\\\",\\\"mergedName\\\":\\\"properties_publicIPAddressVersion\\\",\\\"fromId\\\":\\\"a380f406-d151-4823-bfb4-e5e91270631c\\\"},{\\\"originalName\\\":\\\"[query - grid ARG].count_\\\",\\\"mergedName\\\":\\\"count_\\\",\\\"fromId\\\":\\\"a380f406-d151-4823-bfb4-e5e91270631c\\\"}]}\",\"size\":0,\"title\":\"Merged view: resources in ARG but not in KQL: {TimeRange:label}\",\"showExportToExcel\":true,\"queryType\":7,\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"subscriptionId\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":null}},{\"columnMatch\":\"resourceGroup\",\"formatter\":14,\"formatOptions\":{\"linkTarget\":null}},{\"columnMatch\":\"publicIPAllocationMethod\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"!=\",\"thresholdValue\":\"Dynamic\",\"representation\":\"more\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Normal\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"name\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"colors\",\"thresholdsGrid\":[{\"representation\":\"green\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"redBright\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"properties_provisioningState\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"!=\",\"thresholdValue\":\"Succeeded\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"success\",\"text\":\"{0}{1}\"}]}}],\"filter\":true,\"sortBy\":[{\"itemKey\":\"$gen_link_resourceGroup_1\",\"sortOrder\":1}]},\"sortBy\":[{\"itemKey\":\"$gen_link_resourceGroup_1\",\"sortOrder\":1}]},\"showPin\":false,\"name\":\"query - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AzureActivity\\r\\n| where Category == \\\"Administrative\\\"\\r\\n| where OperationNameValue startswith  \\\"Microsoft.Network/networkSecurityGroups/\\\"\\r\\n| summarize count() by OperationNameValue, ActivitySubstatus, bin(TimeGenerated,{TimeRange:grain})\",\"size\":1,\"title\":\"Network Activity: NSG Administrative for '{Workspace:name}'\",\"timeContextFromParameter\":\"TimeRange\",\"timeBrushParameterName\":\"tbActivitySubstatus\",\"exportFieldName\":\"ActivitySubstatus\",\"exportParameterName\":\"ActivitySubstatusExport\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"categoricalbar\"},\"name\":\"query - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AzureActivity\\r\\n| where Category == \\\"Administrative\\\"\\r\\n| where OperationNameValue startswith  \\\"Microsoft.Network/networkSecurityGroups/\\\"\\r\\n| summarize count() by ActivityStatus, OperationNameValue, ActivitySubstatus , ResourceId, Caller, CallerIpAddress,  bin(TimeGenerated,{TimeRange:grain})\",\"size\":1,\"title\":\"Network Activity: NSG Administrative for '{Workspace:name}'\",\"timeContextFromParameter\":\"tbActivitySubstatus\",\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"filter\":true,\"sortBy\":[{\"itemKey\":\"ActivitySubstatus\",\"sortOrder\":2}]},\"sortBy\":[{\"itemKey\":\"ActivitySubstatus\",\"sortOrder\":2}]},\"name\":\"query - 8 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AzureActivity\\r\\n| where Category == \\\"Administrative\\\"\\r\\n| where OperationNameValue startswith  \\\"Microsoft.Network/\\\"\\r\\n| summarize count() by OperationNameValue, ActivitySubstatus, bin(TimeGenerated,{TimeRange:grain})\\r\\n\",\"size\":1,\"title\":\"Network Activity: All Administrative Operations for '{Workspace:name}'\",\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"unstackedbar\"},\"name\":\"query - 8 - Copy\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Network\"},\"name\":\"group - PIP\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Group: Computer\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//\\r\\n// check for Private and Public IP and map to computer name\\r\\n// \\r\\nResources\\r\\n| where type =~ 'microsoft.network/networkinterfaces'\\r\\n| project privateState    =  tostring(properties.provisioningState),\\r\\n        // Use JSONpath to get values\\r\\n         privateIPmethod =  tostring(properties.ipConfigurations[0].properties.privateIPAllocationMethod) ,\\r\\n         privateIPver    =  tostring(properties.ipConfigurations[0].properties.privateIPAddressVersion),\\r\\n         privateIP       =  tostring(properties.ipConfigurations[0].properties.privateIPAddress),\\r\\n         publicIP        =  tolower(tostring(properties.ipConfigurations[0].properties.publicIPAddress.id)),\\r\\n         vmId            =  tostring(properties.virtualMachine.id),\\r\\n         id,\\r\\n         subscriptionId,\\r\\n         resourceGroup\\r\\n| where isnotempty(vmId)\\r\\n// add Computer name - formatted with a icon\\r\\n| parse vmId with * \\\"virtualMachines/\\\" computerName\\r\\n| extend computerName = strcat(\\\"üñ•Ô∏è\\\", trim(@\\\"[^\\\\w]+\\\",computerName))  \\r\\n// Join to PublicIP source\\r\\n| join \\r\\n(\\r\\nresources\\r\\n| where type == \\\"microsoft.network/publicipaddresses\\\"\\r\\n| project id = tolower(id),\\r\\n          publicIPver = tostring(properties.publicIPAddressVersion),\\r\\n          publicIP = tostring(properties.ipAddress),\\r\\n          publicState = tostring(properties.provisioningState), \\r\\n          publicIPmethod = tostring(properties.publicIPAllocationMethod)\\r\\n) on $left.publicIP == $right.id\\r\\n| order by vmId asc\\r\\n| project vmId, publicIP, publicIP1, publicState, publicIPver, publicIPmethod,\\r\\n          privateIP, privateState, privateIPver, privateIPmethod,\\r\\n          subscriptionId,\\r\\n          resourceGroup\\r\\n              \\r\\n\",\"size\":0,\"title\":\"Computer, Public IP and Private IP information\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"subscriptionId\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":null}},{\"columnMatch\":\"resourceGroup\",\"formatter\":14,\"formatOptions\":{\"linkTarget\":null}}],\"filter\":true,\"labelSettings\":[{\"columnId\":\"vmId\",\"label\":\"Computer Name\"},{\"columnId\":\"publicIP\",\"label\":\"NICpublicName\"},{\"columnId\":\"publicIP1\",\"label\":\"Public IP\"},{\"columnId\":\"publicState\"},{\"columnId\":\"publicIPver\",\"label\":\"\"},{\"columnId\":\"publicIPmethod\"},{\"columnId\":\"privateIP\"},{\"columnId\":\"privateState\"},{\"columnId\":\"privateIPver\"},{\"columnId\":\"privateIPmethod\"}]},\"sortBy\":[]},\"name\":\"query - Computer\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"\\r\\n//\\r\\n// check for Private and Public IP and map to computer name\\r\\n// \\r\\nResources\\r\\n| where type =~ 'microsoft.network/networkinterfaces'\\r\\n| project privateState    =  tostring(properties.provisioningState),\\r\\n        // Use JSONpath to get values\\r\\n         privateIPmethod =  tostring(properties.ipConfigurations[0].properties.privateIPAllocationMethod) ,\\r\\n         privateIPver    =  tostring(properties.ipConfigurations[0].properties.privateIPAddressVersion),\\r\\n         privateIP       =  tostring(properties.ipConfigurations[0].properties.privateIPAddress),\\r\\n         publicIP        =  tolower(tostring(properties.ipConfigurations[0].properties.publicIPAddress.id)),\\r\\n         vmId            =  tostring(properties.virtualMachine.id),\\r\\n         id,\\r\\n         subscriptionId,\\r\\n         resourceGroup\\r\\n| where isnotempty(vmId)\\r\\n// add Computer name - formatted with a icon\\r\\n| parse vmId with * \\\"virtualMachines/\\\" computerName\\r\\n| extend computerName = strcat(\\\"üñ•Ô∏è\\\", trim(@\\\"[^\\\\w]+\\\",computerName))  \\r\\n| join \\r\\n(\\r\\nresources\\r\\n| where type == \\\"microsoft.network/publicipaddresses\\\"\\r\\n| project id = tolower(id),\\r\\n          publicState = tostring(properties.provisioningState), \\r\\n          publicIPmethod = tostring(properties.publicIPAllocationMethod),\\r\\n          publicIPver = tostring(properties.publicIPAddressVersion),\\r\\n          publicIP = tostring(properties.ipAddress)\\r\\n) on $left.publicIP == $right.id\\r\\n| summarize   PublicIP = count(publicIP), PrivateIP = count(privateIP), ComputerCount = dcount(vmId)  by Version=privateIPver\",\"size\":4,\"title\":\"IPv4 or IPv6 \",\"exportFieldName\":\"ComuterName\",\"exportParameterName\":\"ComputerNameExport\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"PublicIP\",\"formatter\":22,\"formatOptions\":{\"compositeBarSettings\":{\"labelText\":\"Public:[\\\"PublicIP\\\"] Private:[\\\"PrivateIP\\\"]\",\"columnSettings\":[{\"columnName\":\"PublicIP\",\"color\":\"blue\"},{\"columnName\":\"PrivateIP\",\"color\":\"red\"}]}}},{\"columnMatch\":\"PrivateIP\",\"formatter\":5},{\"columnMatch\":\"ComputerCount\",\"formatter\":5},{\"columnMatch\":\"privateIP\",\"formatter\":5},{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"name\",\"formatter\":5},{\"columnMatch\":\"type\",\"formatter\":5},{\"columnMatch\":\"tenantId\",\"formatter\":5},{\"columnMatch\":\"kind\",\"formatter\":5},{\"columnMatch\":\"resourceGroup\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"managedBy\",\"formatter\":5},{\"columnMatch\":\"apiVersion\",\"formatter\":5},{\"columnMatch\":\"sku\",\"formatter\":5},{\"columnMatch\":\"plan\",\"formatter\":5},{\"columnMatch\":\"properties\",\"formatter\":5},{\"columnMatch\":\"tags\",\"formatter\":5},{\"columnMatch\":\"aliases\",\"formatter\":5},{\"columnMatch\":\"identity\",\"formatter\":5},{\"columnMatch\":\"zones\",\"formatter\":5},{\"columnMatch\":\"privateState\",\"formatter\":5},{\"columnMatch\":\"properties_ipConfigurations\",\"formatter\":5}],\"labelSettings\":[{\"columnId\":\"Version\"},{\"columnId\":\"PublicIP\",\"label\":\"IP count by type\"},{\"columnId\":\"PrivateIP\"},{\"columnId\":\"ComputerCount\"}]},\"sortBy\":[],\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"Version\",\"formatter\":1},\"subtitleContent\":{\"columnMatch\":\"ComputerCount\",\"formatter\":12,\"formatOptions\":{\"palette\":\"blue\"},\"tooltipFormat\":{\"tooltip\":\"Computers\"}},\"leftContent\":{\"columnMatch\":\"PublicIP\",\"formatter\":12,\"formatOptions\":{\"palette\":\"green\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}},\"tooltipFormat\":{\"tooltip\":\"Public IP\"}},\"rightContent\":{\"columnMatch\":\"PrivateIP\",\"formatter\":12,\"formatOptions\":{\"palette\":\"orange\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\"}},\"tooltipFormat\":{\"tooltip\":\"Private IP\"}},\"showBorder\":true},\"graphSettings\":{\"type\":2,\"topContent\":{\"columnMatch\":\"computerName\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"count_publicIP\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"nodeIdField\":\"computerName\",\"sourceIdField\":\"count_publicIP\",\"nodeSize\":{\"sizeField\":\"count_publicIP\",\"minSize\":10,\"maxSize\":20},\"staticNodeSize\":100,\"colorSettings\":{\"nodeColorField\":\"count_publicIP\",\"type\":4,\"heatmapPalette\":\"greenRed\",\"heatmapMin\":null,\"heatmapMax\":null,\"emptyValueColor\":\"gray\"},\"hivesMargin\":5}},\"name\":\"query - Computer - ipVersion\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscription}\"],\"parameters\":[{\"id\":\"9e9e9d3e-4848-4c67-a262-661ac027c6f6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SelectDirection\",\"label\":\"Show Security Rule\",\"type\":10,\"description\":\"Shows Data direction  \",\"isRequired\":true,\"query\":\"resources\\r\\n| where type == 'microsoft.network/networksecuritygroups'\\r\\n| mv-expand properties.securityRules\\r\\n| extend srName      = tostring(properties_securityRules.name), \\r\\n         srDirection = tostring(properties_securityRules.properties.direction)\\r\\n| distinct srDirection    \\r\\n| summarize by srDirection\\r\\n\\r\\n\\r\\n\\r\\n\",\"crossComponentResources\":[\"{Subscription}\"],\"value\":\"Inbound\",\"typeSettings\":{\"additionalResourceOptions\":[]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"9e9e9d3e-4848-4c67-a262-661ac027c6f6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SelectDirectiondsr\",\"label\":\"Show Default Security Rule\",\"type\":10,\"description\":\"Shows Data direction  \",\"isRequired\":true,\"query\":\"// Show Inbound or Outboud direction for the toggle control\\r\\nresources\\r\\n| where type == 'microsoft.network/networksecuritygroups'\\r\\n| mv-expand properties.defaultSecurityRules\\r\\n| extend dsrDirection = tostring(properties_defaultSecurityRules.properties.direction)\\r\\n| distinct  dsrDirection     \\r\\n\\r\\n\\r\\n\\r\\n\\r\\n\",\"crossComponentResources\":[\"{Subscription}\"],\"value\":\"Outbound\",\"typeSettings\":{\"additionalResourceOptions\":[]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"9e9e9d3e-4848-4c67-a262-661ac027c6f6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SelectPort\",\"label\":\"Show: Securtity Ports\",\"type\":10,\"isRequired\":true,\"query\":\"// get a full list of all Security Ports that Have a NSG mapped to a NIC\\r\\nResources\\r\\n| where type =~ 'microsoft.network/networkinterfaces'\\r\\n| project nsgId = tolower(tostring(properties.networkSecurityGroup.id)), vmId = tostring(properties.virtualMachine.id)\\r\\n| where isnotempty(vmId) and nsgId has 'NSG'\\r\\n| summarize by nsgId, vmId\\r\\n| join (\\r\\n\\tresources\\r\\n\\t| where type =~ 'microsoft.network/networksecuritygroups'\\r\\n\\t| mv-expand properties.securityRules\\r\\n\\t| extend srPortRange = tostring(properties_securityRules.properties.destinationPortRange)\\r\\n\\t| project  id = tolower(id), location, srPortRange\\r\\n) on $left.nsgId == $right.id\\r\\n| where isnotempty(srPortRange)\\r\\n| order by srPortRange desc\\r\\n// Add a \\\"Shows all\\\" to the list of ports\\r\\n| project a = pack_array(srPortRange, \\\"Show All\\\")\\r\\n| summarize a = make_set(a)\\r\\n| mv-expand a\\r\\n| order by todouble(a) asc\\r\\n\\r\\n\\r\\n\",\"crossComponentResources\":[\"{Subscription}\"],\"value\":\"3389\",\"typeSettings\":{\"additionalResourceOptions\":[]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"id\":\"9e9e9d3e-4848-4c67-a262-661ac027c6f6\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"SelectDefaultPort\",\"label\":\"Show: Default Security Ports\",\"type\":10,\"isRequired\":true,\"query\":\"// get a full list of all Default Ports that have a NSG mapped to a NIC resource\\r\\nResources\\r\\n| where type =~ 'microsoft.network/networkinterfaces'\\r\\n| project nsgId = tolower(tostring(properties.networkSecurityGroup.id)), vmId = tostring(properties.virtualMachine.id)\\r\\n| where isnotempty(vmId) and nsgId has 'NSG'\\r\\n| summarize by nsgId, vmId\\r\\n| join (\\r\\nresources\\r\\n| where type =~ 'microsoft.network/networksecuritygroups'\\r\\n| mv-expand properties.defaultSecurityRules\\r\\n| extend dsrPortRange = tostring(properties_defaultSecurityRules.properties.destinationPortRange)\\r\\n| project id = tolower(id),dsrPortRange\\r\\n) on $left.nsgId == $right.id\\r\\n// Add a \\\"Show all\\\" to the list \\r\\n| project a = pack_array(dsrPortRange, \\\"Show All\\\")\\r\\n| summarize a = make_set(a)\\r\\n| mv-expand a\\r\\n| order by todouble(a) desc nulls last\\r\\n\\r\\n\\r\\n\",\"crossComponentResources\":[\"{Subscription}\"],\"value\":\"Show All\",\"typeSettings\":{\"additionalResourceOptions\":[]},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"name\":\"parameters - Selection\",\"styleSettings\":{\"showBorder\":true}},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"9942b177-0269-4d8e-9bc6-349d9c8682bd\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ColumnHelp\",\"label\":\"Enable Column Help?\",\"type\":10,\"description\":\"Show some extra help to explain the Column heading below \",\"isRequired\":true,\"typeSettings\":{\"additionalResourceOptions\":[]},\"jsonData\":\"[\\r\\n { \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true }]\",\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"formHorizontal\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 9\",\"styleSettings\":{\"margin\":\"0\"}},{\"type\":1,\"content\":{\"json\":\"### Filter by Traffic Direction and Security Rules (Ports): Column naming help\\r\\n\\tdsr = Default Securtity Rules\\r\\n\\tsr = Security Rules\\r\\n### Security Rules are in the left-hand report, Default Security rules on the right\",\"style\":\"info\"},\"conditionalVisibility\":{\"parameterName\":\"ColumnHelp\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},\"name\":\"text - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//\\r\\n// Map Computer to NSG id to allow grouping \\r\\n//\\r\\nResources\\r\\n| where type =~ 'microsoft.network/networkinterfaces'\\r\\n| project nsgId = tolower(tostring(properties.networkSecurityGroup.id)), vmId = tostring(properties.virtualMachine.id)\\r\\n| where isnotempty(vmId) and nsgId has 'NSG'\\r\\n| summarize by nsgId, vmId\\r\\n| join (\\r\\nresources\\r\\n| where type =~ 'microsoft.network/networksecuritygroups'\\r\\n| mv-expand properties.securityRules\\r\\n| extend srName      = tostring(properties_securityRules.name), \\r\\n         srDirection = tostring(properties_securityRules.properties.direction),\\r\\n         srPortRange = tostring(properties_securityRules.properties.destinationPortRange), \\r\\n         srDesc      = tostring(properties_securityRules.properties.description),\\r\\n\\t\\t srAccess    = tostring(properties_securityRules.properties.access),\\r\\n\\t\\t srPriority  = tostring(properties_securityRules.properties.priority)\\r\\n| project subscriptionId, id = tolower(id), location,\\r\\n          srName, srDirection, srPortRange, srDesc, srAccess, srPriority\\r\\n) on $left.nsgId == $right.id\\r\\n| where isnotempty(srPortRange)               \\r\\n// filter on parameters supplied, handle \\\"Show all\\\" and any selected parameter\\r\\n| where srDirection in ('{SelectDirection}') \\r\\n| where srPortRange = iif('{SelectPort}' ==\\\"Show All\\\",true,srPortRange in ('{SelectPort}') ) \\r\\n| project vmId=split(vmId,\\\"/virtualMachines/\\\").[1], id , location,\\r\\n          srName, srDirection, srPortRange, srDesc, srAccess, srPriority, subscriptionId\\r\\n\",\"size\":0,\"title\":\"Filter report by '{SelectDirection}' and '{SelectPort}'\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"vmId\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"subscriptionId\",\"formatter\":15,\"formatOptions\":{\"linkTarget\":null}}],\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"vmId\",\"id\"]},\"labelSettings\":[{\"columnId\":\"vmId\",\"label\":\"Computer Name\"},{\"columnId\":\"id\",\"label\":\"NSG name\"},{\"columnId\":\"location\"},{\"columnId\":\"srName\"},{\"columnId\":\"srDirection\"},{\"columnId\":\"srPortRange\"},{\"columnId\":\"srDesc\"},{\"columnId\":\"srAccess\"},{\"columnId\":\"srPriority\"},{\"columnId\":\"subscriptionId\"}]}},\"customWidth\":\"50\",\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"//\\r\\n// Map Computer to NSG id to allow grouping \\r\\n//\\r\\nResources\\r\\n| where type =~ 'microsoft.network/networkinterfaces'\\r\\n| project nsgId = tolower(tostring(properties.networkSecurityGroup.id)), vmId = tostring(properties.virtualMachine.id)\\r\\n| where isnotempty(vmId) and nsgId has 'NSG'\\r\\n| summarize by nsgId, vmId\\r\\n| join (\\r\\nresources\\r\\n| where type =~ 'microsoft.network/networksecuritygroups'\\r\\n| mv-expand properties.defaultSecurityRules\\r\\n| extend dsrName      = tostring(properties_defaultSecurityRules.name), \\r\\n         dsrDirection = tostring(properties_defaultSecurityRules.properties.direction),\\r\\n         dsrPortRange = tostring(properties_defaultSecurityRules.properties.destinationPortRange), \\r\\n         dsrDesc      = tostring(properties_defaultSecurityRules.properties.description),\\r\\n\\t\\t dsrAccess    = tostring(properties_defaultSecurityRules.properties.access),\\r\\n\\t\\t dsrPriority  = tostring(properties_defaultSecurityRules.properties.priority)\\r\\n| project subscriptionId, id = tolower(id), location,\\r\\n          dsrName, dsrDirection, dsrPortRange, dsrDesc, dsrAccess, dsrPriority\\r\\n) on $left.nsgId == $right.id\\r\\n| where isnotempty(dsrPortRange)               \\r\\n// filter on parameters supplied, handle \\\"Show all\\\" and any selected parameter\\r\\n| where dsrDirection in ('{SelectDirectiondsr}') \\r\\n| where dsrPortRange = iif('{SelectDefaultPort}' ==\\\"Show All\\\",true,dsrPortRange in ('{SelectDefaultPort}') ) \\r\\n| project vmId=split(vmId,\\\"/virtualMachines/\\\").[1], id , location,\\r\\n          dsrName, dsrDirection, dsrPortRange, dsrDesc, dsrAccess, dsrPriority, subscriptionId\",\"size\":0,\"title\":\"Filter report Default Security  '{SelectDirectiondsr}' and '{SelectDefaultPort}'\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscription}\"],\"gridSettings\":{\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"vmId\",\"id\"]},\"labelSettings\":[{\"columnId\":\"vmId\",\"label\":\"Computer Name\"},{\"columnId\":\"id\",\"label\":\"NSG Name\"},{\"columnId\":\"location\"},{\"columnId\":\"dsrName\"},{\"columnId\":\"dsrDirection\"},{\"columnId\":\"dsrPortRange\"},{\"columnId\":\"dsrDesc\"},{\"columnId\":\"dsrAccess\"},{\"columnId\":\"dsrPriority\"},{\"columnId\":\"subscriptionId\"}]}},\"customWidth\":\"50\",\"name\":\"query - 7\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Computer\"},\"name\":\"group - Computer\"},{\"type\":1,\"content\":{\"json\":\"## select a workspace to see saved queries.\"},\"conditionalVisibilities\":[{\"parameterName\":\"Workspace\",\"comparison\":\"isEqualTo\"},{\"parameterName\":\"Subscription\",\"comparison\":\"isNotEqualTo\"}],\"name\":\"no workspace set\"},{\"type\":1,\"content\":{\"json\":\"## select one or more subscriptions, then pick a workspace to get started\"},\"conditionalVisibility\":{\"parameterName\":\"Subscription\",\"comparison\":\"isEqualTo\"},\"name\":\"no subscription selected\"}]},\"conditionalVisibilities\":[{\"parameterName\":\"network\",\"comparison\":\"isEqualTo\",\"value\":\"pips\"},{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"network\"}],\"name\":\"group - 132\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Resources\\r\\n| where type =~ 'microsoft.network/networksecuritygroups' and isnull(properties.networkInterfaces) and isnull(properties.subnets)\\r\\n| project Resource=id, resourceGroup, subscriptionId, location\",\"size\":0,\"noDataMessage\":\"No Unassociated NSGs Found\",\"noDataMessageStyle\":3,\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"Resource\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Resource\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortCriteriaField\":\"count_\",\"sortOrderField\":2}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"network\"},{\"parameterName\":\"network\",\"comparison\":\"isEqualTo\",\"value\":\"blanknsgs\"}],\"name\":\"query - Networking Details - Unassociated NSGs\",\"styleSettings\":{\"padding\":\"0 0 100px 0\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Resources\\r\\n    | where type =~ 'microsoft.network/networksecuritygroups'\\r\\n    | project id, nsgRules = parse_json(parse_json(properties).securityRules), networksecurityGroupName = name, subscriptionId, resourceGroup , location\\r\\n    | mvexpand nsgRule = nsgRules\\r\\n    | project id, location, access=nsgRule.properties.access,protocol=nsgRule.properties.protocol ,direction=nsgRule.properties.direction,provisioningState= nsgRule.properties.provisioningState ,priority=nsgRule.properties.priority, \\r\\n        sourceAddressPrefix = nsgRule.properties.sourceAddressPrefix, \\r\\n        sourceAddressPrefixes = nsgRule.properties.sourceAddressPrefixes,\\r\\n        destinationAddressPrefix = nsgRule.properties.destinationAddressPrefix, \\r\\n        destinationAddressPrefixes = nsgRule.properties.destinationAddressPrefixes, \\r\\n        networksecurityGroupName, networksecurityRuleName = tostring(nsgRule.name), \\r\\n        subscriptionId, resourceGroup,\\r\\n        destinationPortRanges = nsgRule.properties.destinationPortRanges,\\r\\n        destinationPortRange = nsgRule.properties.destinationPortRange,\\r\\n        sourcePortRanges = nsgRule.properties.sourcePortRanges,\\r\\n        sourcePortRange = nsgRule.properties.sourcePortRange\\r\\n| extend Details = pack_all()\\r\\n| project id, location, access, direction, subscriptionId, resourceGroup, Details\",\"size\":2,\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"resourceGroup\",\"formatter\":0,\"formatOptions\":{\"customColumnWidthSetting\":\"24.1429ch\"}},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"id\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortCriteriaField\":\"count_\",\"sortOrderField\":2}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"network\"},{\"parameterName\":\"network\",\"comparison\":\"isEqualTo\",\"value\":\"nsgrules\"}],\"name\":\"query - Networking Details - NSG Rules\",\"styleSettings\":{\"padding\":\"0 0 200px 0\"}},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscriptions}\"],\"parameters\":[{\"id\":\"2a6c17b5-ef20-4ca7-a6f4-00901eb54ed1\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"nsgWithTrafficAnalytics\",\"label\":\"NSG With Flow Logs and Traffic Analytics\",\"type\":1,\"query\":\"Resources\\n| where type =~ 'Microsoft.Network/networkWatchers/flowlogs'\\n| extend provisioningState = parse_json(properties).provisioningState \\n| extend workspaceResourceId = tostring(parse_json(parse_json(parse_json(properties).flowAnalyticsConfiguration).networkWatcherFlowAnalyticsConfiguration).workspaceResourceId)\\n| extend targetResourceId = iff(notempty(workspaceResourceId) and provisioningState == \\\"Succeeded\\\", tostring(parse_json(properties).targetResourceId), \\\"null\\\" ) \\n| distinct targetResourceId\\n\",\"crossComponentResources\":[\"{Subscriptions}\"],\"isHiddenWhenLocked\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},{\"version\":\"KqlParameterItem/1.0\",\"name\":\"nsgWithFlowLogs\",\"label\":\"NSG With Flow Logs\",\"type\":1,\"query\":\"Resources\\n| where type =~ 'Microsoft.Network/networkWatchers/flowlogs'\\n| extend provisioningState = parse_json(properties).provisioningState \\n| extend targetResourceId = iff(provisioningState == \\\"Succeeded\\\", tostring(parse_json(properties).targetResourceId), \\\"null\\\" ) \\n| distinct targetResourceId\\n\",\"crossComponentResources\":[\"{Subscriptions}\"],\"isHiddenWhenLocked\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"id\":\"c8a786fc-40ff-4594-83b5-6952c6928523\"}],\"style\":\"above\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"network\"},{\"parameterName\":\"network\",\"comparison\":\"isEqualTo\",\"value\":\"nsgrules\"}],\"name\":\"query - Networking Details - NSG with Flow Logs and Traffic Analytics\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Resources\\r\\n| where type =~ 'microsoft.network/networksecuritygroups'\\r\\n| extend flowLogs = \\\"{nsgWithFlowLogs}\\\" has id\\r\\n| extend trafficAnalytics = \\\"{nsgWithTrafficAnalytics}\\\" has id\\r\\n| project subscriptionId, ['Resource group'] = strcat('/subscriptions/', subscriptionId, '/resourceGroups/', resourceGroup), ['Network Security Group'] = id, [\\\"Location\\\"]=location, [\\\"Flow Logs\\\"]=flowLogs, [\\\"Traffic Analytics\\\"]=trafficAnalytics\\r\\n\\r\\n\",\"size\":2,\"title\":\"Network Security Groups\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"subscriptionId\",\"formatter\":5,\"formatOptions\":{\"linkTarget\":\"Resource\"}},{\"columnMatch\":\"Resource group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"Network Security Group\",\"formatter\":5},{\"columnMatch\":\"Flow Logs\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"1\",\"representation\":\"success\",\"text\":\"Enabled\"},{\"operator\":\"==\",\"thresholdValue\":\"0\",\"representation\":\"disabled\",\"text\":\"Disabled\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"unknown\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"Traffic Analytics\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"1\",\"representation\":\"success\",\"text\":\"Enabled\"},{\"operator\":\"==\",\"thresholdValue\":\"0\",\"representation\":\"disabled\",\"text\":\"Disabled\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"unknown\",\"text\":\"unknown\"}]}},{\"columnMatch\":\"Subscription\",\"formatter\":5,\"formatOptions\":{\"linkTarget\":\"Resource\"}},{\"columnMatch\":\"Flow logs\",\"formatter\":11,\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},{\"columnMatch\":\"Resource\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Network Security Group\"}},\"sortBy\":[]},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"network\"},{\"parameterName\":\"network\",\"comparison\":\"isEqualTo\",\"value\":\"nsg\"}],\"name\":\"Network Security Groups\"},{\"type\":1,\"content\":{\"json\":\"## End Networking\\r\\n\\r\\n\\r\\n## Begin Monitoring & Security\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - End Networking\"},{\"type\":1,\"content\":{\"json\":\"## Monitor & Security  \\r\\n   \\r\\n   \\r\\n   \\r\\n### Workspaces Overview\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},\"name\":\"text - Monitor & Security\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources \\r\\n| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\nor type =~ 'microsoft.insights/components'\\r\\n| summarize count() by type\\r\\n| extend type = case(\\r\\ntype == 'microsoft.insights/components', \\\"Application Insights\\\",\\r\\ntype == 'microsoft.operationalinsights/workspaces', \\\"Log Analytics workspaces\\\",\\r\\nstrcat(type, type))\",\"size\":4,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Solutions\",\"formatter\":5},{\"columnMatch\":\"AzureSecurityCenter\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AzureSecurityCenterFree\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AzureSentinel\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AzureMonitorVMs\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"ServiceDesk\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AzureAutomation\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"ChangeTracking\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"UpdateManagement\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"UpdateCompliance\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AzureMonitorContainers\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"KeyVaultAnalytics\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"SQLHealthCheck\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}}]},\"sortBy\":[],\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},\"name\":\"query - Monitoring Security Overview - Copy - Copy\"},{\"type\":1,\"content\":{\"json\":\"### Azure Monitor Workbooks & Alerting Resources\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},\"name\":\"text - Monitor & Security - Azure Monitor Alerts\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type has 'microsoft.insights/'\\r\\n     or type has 'microsoft.alertsmanagement/smartdetectoralertrules'\\r\\n     or type has 'microsoft.portal/dashboards'\\r\\n| where type != 'microsoft.insights/components'\\r\\n| extend type = case(\\r\\n \\ttype == 'microsoft.insights/workbooks', \\\"Workbooks\\\",\\r\\n\\ttype == 'microsoft.insights/activitylogalerts', \\\"Activity Log Alerts\\\",\\r\\n\\ttype == 'microsoft.insights/scheduledqueryrules', \\\"Log Search Alerts\\\",\\r\\n\\ttype == 'microsoft.insights/actiongroups', \\\"Action Groups\\\",\\r\\n\\ttype == 'microsoft.insights/metricalerts', \\\"Metric Alerts\\\",\\r\\n\\ttype =~ 'microsoft.alertsmanagement/smartdetectoralertrules','Smart Detection Rules',\\r\\n    type =~ 'microsoft.insights/webtests', 'URL Web Tests',\\r\\n    type =~ 'microsoft.portal/dashboards', 'Portal Dashboards',\\r\\n    type =~ 'microsoft.insights/datacollectionrules', 'Data Collection Rules',\\r\\n    type =~ 'microsoft.insights/autoscalesettings', 'Auto Scale Settings',\\r\\n    type =~ 'microsoft.insights/alertrules', 'Alert Rules',\\r\\nstrcat(\\\"Not Translated: \\\", type))\\r\\n| summarize count() by type\",\"size\":1,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Solutions\",\"formatter\":5},{\"columnMatch\":\"AzureSecurityCenter\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AzureSecurityCenterFree\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AzureSentinel\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AzureMonitorVMs\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"ServiceDesk\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AzureAutomation\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"ChangeTracking\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"UpdateManagement\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"UpdateCompliance\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AzureMonitorContainers\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"KeyVaultAnalytics\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"SQLHealthCheck\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}}]},\"sortBy\":[],\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true,\"sortCriteriaField\":\"count_\",\"sortOrderField\":2}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},\"name\":\"query - Monitoring Security Overview - Copy\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"ed3b3650-dd46-4a66-9acd-cbda10b14c04\",\"cellValue\":\"monitor\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Active Alerts\",\"subTarget\":\"alerts\",\"preText\":\"Active Alerts\",\"style\":\"link\"},{\"id\":\"9224d88a-9c0d-49de-8b24-38b3f8c380d3\",\"cellValue\":\"monitor\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Workbooks & Alerting Resources\",\"subTarget\":\"alertresources\",\"preText\":\"Monitor Resources\",\"style\":\"link\"},{\"id\":\"b90eaf7d-647e-4b37-ae0a-6fc6a49ce07c\",\"cellValue\":\"monitor\",\"linkTarget\":\"parameter\",\"linkLabel\":\"App Monitoring\",\"subTarget\":\"apm\",\"preText\":\"App Monitoring\",\"style\":\"link\"},{\"id\":\"1b181560-7b87-4f30-886c-2054a3648401\",\"cellValue\":\"monitor\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Log Analytics\",\"subTarget\":\"loganalytics\",\"preText\":\"Log Analytics\",\"style\":\"link\"},{\"id\":\"d19b8a04-9a79-40ca-90a6-7ebc1be7fe75\",\"cellValue\":\"monitor\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Security Score\",\"subTarget\":\"security\",\"preText\":\"Security Score\",\"style\":\"link\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},\"name\":\"links - Monitor & Security - Tabs\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - Begin - Monitor & Security - Active Alerts\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow - Begin Active Alerts\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AlertsManagementResources\\r\\n| extend AlertStatus = properties.essentials.monitorCondition\\r\\n| extend AlertState = properties.essentials.alertState\\r\\n| extend AlertTime = properties.essentials.startDateTime\\r\\n| extend AlertSuppressed = properties.essentials.actionStatus.isSuppressed\\r\\n| extend Severity = properties.essentials.severity\\r\\n| where AlertStatus == 'Fired'\\r\\n| extend Details = pack_all()\\r\\n| project id, name, subscriptionId, resourceGroup, AlertStatus, AlertState, AlertTime, AlertSuppressed, Severity, Details\",\"size\":2,\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"name\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"name\"}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},{\"parameterName\":\"monitor\",\"comparison\":\"isEqualTo\",\"value\":\"alerts\"}],\"name\":\"query - Monitor & Security - Active Alerts\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - End - Monitor & Security - Active Alerts\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow - End Active Alerts\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - Begin Monitor & Security - Alerting Resources\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow - Begin Alerting Resources\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type has 'microsoft.insights/'\\r\\n     or type has 'microsoft.alertsmanagement/smartdetectoralertrules'\\r\\n    or type has 'microsoft.portal/dashboards'\\r\\n| where type != 'microsoft.insights/components'\\r\\n| extend type = case(\\r\\n \\ttype == 'microsoft.insights/workbooks', \\\"Workbooks\\\",\\r\\n\\ttype == 'microsoft.insights/activitylogalerts', \\\"Activity Log Alerts\\\",\\r\\n\\ttype == 'microsoft.insights/scheduledqueryrules', \\\"Log Search Alerts\\\",\\r\\n\\ttype == 'microsoft.insights/actiongroups', \\\"Action Groups\\\",\\r\\n\\ttype == 'microsoft.insights/metricalerts', \\\"Metric Alerts\\\",\\r\\n\\ttype =~ 'microsoft.alertsmanagement/smartdetectoralertrules','Smart Detection Rules',\\r\\n    type =~ 'microsoft.portal/dashboards', 'Portal Dashboards',\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| extend Enabled = case(\\r\\n\\ttype =~ 'Smart Detection Rules', properties.state,\\r\\n\\ttype != 'Smart Detection Rules', properties.enabled,\\r\\n\\tstrcat(\\\"Not Translated: \\\", type))\\r\\n| extend WorkbookType = iif(type =~ 'Workbooks', properties.category, ' ')\\r\\n| extend Details = pack_all()\\r\\n| project name, type, subscriptionId, location, resourceGroup, Enabled, WorkbookType, Details\",\"size\":2,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"name\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"id\",\"formatter\":5}],\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"name\"}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},{\"parameterName\":\"monitor\",\"comparison\":\"isEqualTo\",\"value\":\"alertresources\"}],\"name\":\"query - Monitor & Security - Alerting Resources\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - End - Monitor & Security - Alerting Resources\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow - End Alerting Resources\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - Begin - Monitor & Security - App Monitoring\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow - Begin App Monitoring\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"where type =~ 'microsoft.insights/components'\\r\\n| extend RetentionInDays = properties.RetentionInDays\\r\\n| extend IngestionMode = properties.IngestionMode\\r\\n| extend Details = pack_all()\\r\\n| project Resource=id, location, resourceGroup, subscriptionId, IngestionMode, RetentionInDays, Details\",\"size\":2,\"exportedParameters\":[{\"fieldName\":\"Resource\",\"parameterName\":\"appinsight\",\"parameterType\":5}],\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"Resource\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"name\",\"formatter\":5}],\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Resource\"}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},{\"parameterName\":\"monitor\",\"comparison\":\"isEqualTo\",\"value\":\"apm\"}],\"name\":\"query - Monitor & Security - App Monitoring\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - End - Monitor & Security - App Monitoring\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow - End App Monitoring\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - Begin - Monitor & Security - Log Analytics\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow - Begin - App Monitoring\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n| extend Sku = properties.sku.name\\r\\n| extend RetentionInDays = properties.retentionInDays\\r\\n| extend Details = pack_all()\\r\\n| project Workspace=id, resourceGroup, location, subscriptionId, Sku, RetentionInDays, Details\",\"size\":0,\"exportedParameters\":[{\"fieldName\":\"workspace\",\"parameterName\":\"workspace\",\"parameterType\":5}],\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"Workspace\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}}],\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Workspace\"}},\"sortBy\":[]},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},{\"parameterName\":\"monitor\",\"comparison\":\"isEqualTo\",\"value\":\"loganalytics\"}],\"name\":\"query - Monitoring Security Overview - Copy\"},{\"type\":1,\"content\":{\"json\":\"### Log Analytics workspaces with enabled Solutions\\r\\n\\r\\nüí° Select workspace to see data tables and resources logging to that workspace\\r\\n\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},{\"parameterName\":\"monitor\",\"comparison\":\"isEqualTo\",\"value\":\"loganalytics\"}],\"name\":\"text - Monitor & Security - workspace details\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type == \\\"microsoft.operationsmanagement/solutions\\\"\\r\\n| project Solution=plan.name, Workspace=tolower(tostring(properties.workspaceResourceId)), subscriptionId\\r\\n\\t| join kind=leftouter(\\r\\n\\t\\tresources\\r\\n\\t\\t| where type =~ 'microsoft.operationalinsights/workspaces'\\r\\n\\t\\t| project Workspace=tolower(tostring(id)),subscriptionId) on Workspace\\r\\n| summarize Solutions = strcat_array(make_list(Solution), \\\",\\\") by Workspace, subscriptionId\\r\\n| extend AzureSecurityCenter = iif(Solutions has 'Security','Enabled','Not Enabled')\\r\\n| extend AzureSecurityCenterFree = iif(Solutions has 'SecurityCenterFree','Enabled','Not Enabled')\\r\\n| extend AzureSentinel = iif(Solutions has \\\"SecurityInsights\\\",'Enabled','Not Enabled')\\r\\n| extend AzureMonitorVMs = iif(Solutions has \\\"VMInsights\\\",'Enabled','Not Enabled')\\r\\n| extend ServiceDesk = iif(Solutions has \\\"ITSM Connector\\\",'Enabled','Not Enabled')\\r\\n| extend AzureAutomation = iif(Solutions has \\\"AzureAutomation\\\",'Enabled','Not Enabled')\\r\\n| extend ChangeTracking = iif(Solutions has 'ChangeTracking','Enabled','Not Enabled')\\r\\n| extend UpdateManagement = iif(Solutions has 'Updates','Enabled','Not Enabled')\\r\\n| extend UpdateCompliance = iif(Solutions has 'WaaSUpdateInsights','Enabled','Not Enabled')\\r\\n| extend AzureMonitorContainers = iif(Solutions has 'ContainerInsights','Enabled','Not Enabled')\\r\\n| extend KeyVaultAnalytics = iif(Solutions has 'KeyVaultAnalytics','Enabled','Not Enabled')\\r\\n| extend SQLHealthCheck = iif(Solutions has 'SQLAssessment','Enabled','Not Enabled')\",\"size\":0,\"exportedParameters\":[{\"fieldName\":\"Workspace\",\"parameterName\":\"workspace\",\"parameterType\":5}],\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"Workspace\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"Solutions\",\"formatter\":5},{\"columnMatch\":\"AzureSecurityCenter\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AzureSecurityCenterFree\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AzureSentinel\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AzureMonitorVMs\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"ServiceDesk\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AzureAutomation\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"ChangeTracking\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"UpdateManagement\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"UpdateCompliance\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"AzureMonitorContainers\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"KeyVaultAnalytics\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"SQLHealthCheck\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Not Enabled\",\"representation\":\"disabled\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"thresholdValue\":null,\"representation\":\"Available\",\"text\":\"{0}{1}\"}]}}],\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Workspace\"}},\"sortBy\":[]},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},{\"parameterName\":\"monitor\",\"comparison\":\"isEqualTo\",\"value\":\"loganalytics\"}],\"name\":\"query - Monitoring Security Overview\"},{\"type\":1,\"content\":{\"json\":\"\\r\\n\\r\\nüí° Workspace table usage for selected workspace on the left, resources reported to selected workspace on the right.\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},{\"parameterName\":\"monitor\",\"comparison\":\"isEqualTo\",\"value\":\"loganalytics\"}],\"name\":\"text - Monitor & Security - workspace table usage\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Usage\\r\\n| summarize Size = sum(Quantity) by ['Table Name'] = DataType\\r\\n| sort by Size desc\",\"size\":2,\"noDataMessageStyle\":5,\"timeContext\":{\"durationMs\":86400000},\"exportedParameters\":[{\"fieldName\":\"workspace\",\"parameterName\":\"workspace\",\"parameterType\":5}],\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Size\",\"formatter\":3,\"formatOptions\":{\"palette\":\"orange\",\"customColumnWidthSetting\":\"341px\"},\"numberFormat\":{\"unit\":38,\"options\":{\"style\":\"decimal\"}}}],\"rowLimit\":500,\"filter\":true},\"sortBy\":[]},\"customWidth\":\"50\",\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},{\"parameterName\":\"monitor\",\"comparison\":\"isEqualTo\",\"value\":\"loganalytics\"}],\"name\":\"query - Monitoring Security - Workspace Usage - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"search * | distinct _ResourceId, SubscriptionId\",\"size\":2,\"noDataMessageStyle\":5,\"timeContext\":{\"durationMs\":86400000},\"exportedParameters\":[{\"fieldName\":\"workspace\",\"parameterName\":\"workspace\",\"parameterType\":5}],\"showExportToExcel\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"_ResourceId\",\"formatter\":5},{\"columnMatch\":\"SubscriptionId\",\"formatter\":5}],\"rowLimit\":500,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"SubscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"_ResourceId\"}},\"sortBy\":[]},\"customWidth\":\"50\",\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},{\"parameterName\":\"monitor\",\"comparison\":\"isEqualTo\",\"value\":\"loganalytics\"}],\"name\":\"query - Monitoring Security - Workspace Usage\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - End - Monitor & Security - Log Analytics\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow - End - App Monitoring\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - Begin - Monitor & Security - Security\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow - Begin - App Monitoring - Security\"},{\"type\":1,\"content\":{\"json\":\"### Azure Security Center Secure Store by Subscription\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},{\"parameterName\":\"monitor\",\"comparison\":\"isEqualTo\",\"value\":\"security\"}],\"name\":\"text - Monitor & Security - Secure Score Text\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"securityresources\\r\\n| where type == \\\"microsoft.security/securescores\\\"\\r\\n| extend subscriptionSecureScore = round(100 * bin((todouble(properties.score.current))/ todouble(properties.score.max), 0.001))\\r\\n| where subscriptionSecureScore > 0\\r\\n| project subscriptionSecureScore, subscriptionId\\r\\n| order by subscriptionSecureScore asc\",\"size\":0,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true}},{\"columnMatch\":\"subscriptionSecureScore\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"redGreen\"},\"numberFormat\":{\"unit\":1,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"subscriptionSecureScore\"}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},{\"parameterName\":\"monitor\",\"comparison\":\"isEqualTo\",\"value\":\"security\"}],\"name\":\"query - Monitor & Security - Security Scores\"},{\"type\":1,\"content\":{\"json\":\"### Azure Security Center Secure Controls Score by Controls\\r\\n\\r\\nlists all security controls, the amount of unhealthy resources, their current score and their max score\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},{\"parameterName\":\"monitor\",\"comparison\":\"isEqualTo\",\"value\":\"security\"}],\"name\":\"text - Monitor & Security - Secure Score Text - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"SecurityResources \\r\\n| where type == 'microsoft.security/securescores/securescorecontrols' \\r\\n| extend SecureControl = properties.displayName, unhealthy = properties.unhealthyResourceCount, currentscore = properties.score.current, maxscore = properties.score.max, subscriptionId\\r\\n| project SecureControl , unhealthy, currentscore, maxscore, subscriptionId\",\"size\":3,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":null,\"showIcon\":true,\"customColumnWidthSetting\":\"45ch\"}},{\"columnMatch\":\"SecureControl\",\"formatter\":5},{\"columnMatch\":\"unhealthy\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"palette\":\"greenRed\"}},{\"columnMatch\":\"currentscore\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redGreen\"},\"numberFormat\":{\"unit\":1,\"options\":{\"style\":\"decimal\"}}},{\"columnMatch\":\"maxscore\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\"}},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"subscriptionSecureScore\",\"formatter\":8,\"formatOptions\":{\"min\":0,\"max\":100,\"palette\":\"redGreen\"},\"numberFormat\":{\"unit\":1,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"SecureControl\"}}},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"monitor\"},{\"parameterName\":\"monitor\",\"comparison\":\"isEqualTo\",\"value\":\"security\"}],\"name\":\"query - Monitor & Security - Security Scores - Copy\"},{\"type\":1,\"content\":{\"json\":\"### NoShow - End - Monitor & Security - Security\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow - End - App Monitoring - Security - Copy\"},{\"type\":1,\"content\":{\"json\":\"## End Monitoring & Security\\r\\n\\r\\n## Begin Tagged Resoruces\"},\"conditionalVisibility\":{\"parameterName\":\"noshow\",\"comparison\":\"isEqualTo\",\"value\":\"noshow\"},\"name\":\"text - NoShow End Monitoring\"},{\"type\":1,\"content\":{\"json\":\"## Help File - Resource tags\\r\\n\\r\\nEvery environment has different standards for tagging. Therefore you may need to chance the Environment and Application parameters to reflect the tagging standards in your environment. \",\"style\":\"success\"},\"conditionalVisibilities\":[{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"tags\"},{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"}],\"name\":\"text - Show Help - Resource Tagging\"},{\"type\":1,\"content\":{\"json\":\"## Help File - Resource tags\\r\\n\\r\\nThe below query will list your untagged resources. Note that not all resources currently support tagging.\",\"style\":\"success\"},\"conditionalVisibilities\":[{\"parameterName\":\"Help\",\"comparison\":\"isEqualTo\",\"value\":\"Yes\"},{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"notag\"}],\"name\":\"text - Show Help - No Tags\"},{\"type\":1,\"content\":{\"json\":\"## Showing Resources for {Environment} and Application(s) {Application}\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"tags\"},\"name\":\"text - Show Text for Tagged Selections\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type != 'microsoft.network/networkinterfaces'\\r\\n| where type != 'microsoft.compute/disks'\\r\\n\\r\\n| extend type = case(\\r\\ntype =~ 'microsoft.network/networksecuritygroups', \\\"NSGs\\\", \\r\\ntype =~ \\\"microsoft.network/publicipaddresses\\\", \\\"Public IPs\\\", \\r\\ntype =~ 'microsoft.network/virtualnetworks', \\\"vNets\\\",\\r\\ntype =~ 'microsoft.network/networkwatchers/connectionmonitors', \\\"Connection Monitors\\\",\\r\\ntype =~ 'microsoft.network/privatednszones', \\\"Private DNS\\\",\\r\\ntype =~ 'microsoft.network/virtualnetworkgateways', \\\"vNet Gateways\\\",\\r\\ntype =~ 'microsoft.network/connections', \\\"Connections\\\",\\r\\ntype =~ 'microsoft.network/networkwatchers', \\\"Network Watchers\\\",\\r\\ntype =~ 'microsoft.network/privateendpoints', \\\"Private Endpoints\\\",\\r\\ntype =~ 'microsoft.network/localnetworkgateways', \\\"Local Network Gateways\\\",\\r\\ntype =~ 'microsoft.network/privatednszones/virtualnetworklinks', \\\"vNet Links\\\",\\r\\ntype =~ 'microsoft.web/serverfarms', \\\"App Service Plans\\\",\\r\\nkind == 'functionapp', \\\"Azure Functions\\\", \\r\\nkind == \\\"api\\\", \\\"API Apps\\\", \\r\\ntype =~ 'microsoft.web/sites', \\\"App Services\\\",\\r\\ntype =~ \\\"microsoft.compute/virtualmachines\\\", \\\"Azure Compute\\\",\\r\\ntype =~ \\\"microsoft.logic/workflows\\\", \\\"LogicApps\\\",\\r\\ntype =~ 'microsoft.keyvault/vaults', \\\"Key Vaults\\\",\\r\\ntype =~ 'microsoft.keyvault/vaults', \\\"Hybrid Compute\\\",\\r\\ntype =~ 'microsoft.storage/storageaccounts', \\\"Storage Accounts\\\",\\r\\ntype =~ 'microsoft.compute/availabilitysets', 'Availability Sets',\\r\\ntype =~ 'microsoft.insights/components','Application Insights',\\r\\ntype =~ 'microsoft.desktopvirtualization/applicationgroups', 'WVD Application Groups',\\r\\ntype =~ 'microsoft.desktopvirtualization/workspaces', 'WVD Workspaces',\\r\\ntype =~ 'microsoft.desktopvirtualization/hostpools', 'WVD Hostpools',\\r\\nstrcat(\\\"Not Translated: \\\", type))\\r\\n| summarize count() by type\\r\\n\\r\\n\\r\\n\",\"size\":0,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"tags\"},\"name\":\"query - Tagged Resources\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type != 'microsoft.network/networkinterfaces'\\r\\n| where type != 'microsoft.compute/disks'\\r\\n| extend type = case(\\r\\ntype =~ 'microsoft.network/networksecuritygroups', \\\"NSGs\\\", \\r\\ntype =~ \\\"microsoft.network/publicipaddresses\\\", \\\"Public IPs\\\", \\r\\ntype =~ 'microsoft.network/virtualnetworks', \\\"vNets\\\",\\r\\ntype =~ 'microsoft.network/networkwatchers/connectionmonitors', \\\"Connection Monitors\\\",\\r\\ntype =~ 'microsoft.network/privatednszones', \\\"Private DNS\\\",\\r\\ntype =~ 'microsoft.network/virtualnetworkgateways', \\\"vNet Gateways\\\",\\r\\ntype =~ 'microsoft.network/connections', \\\"Connections\\\",\\r\\ntype =~ 'microsoft.network/networkwatchers', \\\"Network Watchers\\\",\\r\\ntype =~ 'microsoft.network/privateendpoints', \\\"Private Endpoints\\\",\\r\\ntype =~ 'microsoft.network/localnetworkgateways', \\\"Local Network Gateways\\\",\\r\\ntype =~ 'microsoft.network/privatednszones/virtualnetworklinks', \\\"vNet Links\\\",\\r\\ntype =~ 'microsoft.web/serverfarms', \\\"App Service Plans\\\",\\r\\nkind == 'functionapp', \\\"Azure Functions\\\", \\r\\nkind == \\\"api\\\", \\\"API Apps\\\", \\r\\ntype =~ 'microsoft.web/sites', \\\"App Services\\\",\\r\\ntype =~ \\\"microsoft.compute/virtualmachines\\\", \\\"Azure Compute\\\",\\r\\ntype =~ \\\"microsoft.logic/workflows\\\", \\\"LogicApps\\\",\\r\\ntype =~ 'microsoft.keyvault/vaults', \\\"Key Vaults\\\",\\r\\ntype =~ 'microsoft.keyvault/vaults', \\\"Hybrid Compute\\\",\\r\\ntype =~ 'microsoft.storage/storageaccounts', \\\"Storage Accounts\\\",\\r\\ntype =~ 'microsoft.compute/availabilitysets', 'Availability Sets',\\r\\ntype =~ 'microsoft.insights/components','Application Insights',\\r\\ntype =~ 'microsoft.desktopvirtualization/applicationgroups', 'WVD Application Groups',\\r\\ntype =~ 'microsoft.desktopvirtualization/workspaces', 'WVD Workspaces',\\r\\ntype =~ 'microsoft.desktopvirtualization/hostpools', 'WVD Hostpools',\\r\\nstrcat(\\\"Not Translated: \\\", type))\\r\\n| extend Details = pack_all()\\r\\n| project id, subscriptionId, type, location, resourceGroup, Details\\r\\n\\r\\n\\r\\n\",\"size\":0,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"linkIsContextBlade\":false,\"showIcon\":true}},{\"columnMatch\":\"id\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5},{\"columnMatch\":\"Details\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"CellDetails\",\"linkLabel\":\"üîç View Details\",\"linkIsContextBlade\":true}},{\"columnMatch\":\"tenantId\",\"formatter\":5}],\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"id\"}},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"type\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"tags\"},\"name\":\"query - Tagged Resources - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Resources\\r\\n| where tags.Environment in~ ({Environment}) or '*' in~ ({Environment})\\r\\n| where tags.Application in~ ({Application}) or '*' in~ ({Application})\\r\\n| summarize count() by type\",\"size\":0,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"tabs\"},\"name\":\"query - Tagged Resources Summary\"},{\"type\":1,\"content\":{\"json\":\"## NoShow - End Tagged Resources\\r\\n\\r\\n\\r\\n## NoShow - Begin Untagged Resources\"},\"conditionalVisibility\":{\"parameterName\":\"noShow\",\"comparison\":\"isEqualTo\",\"value\":\"noShow\"},\"name\":\"text - NoShow Begin Untagged Resources\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"crossComponentResources\":[\"{Subscriptions}\"],\"parameters\":[{\"id\":\"2ca6744f-0d53-48a0-ad15-95f6dbe5aa9d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ResourceType\",\"type\":7,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"resources | where tags == ''\\r\\n| distinct type\",\"crossComponentResources\":[\"{Subscriptions}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::1\",\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000},\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"}],\"style\":\"pills\",\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"notag\"},\"name\":\"parameters - Untagged Resource Type\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources | where tags == ''\\r\\n| where type in~ ({ResourceType}) or '*' in~ ({ResourceType})\\r\\n| project Name=id, subscriptionId\\r\\n\",\"size\":3,\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"$gen_group\",\"formatter\":13,\"formatOptions\":{\"linkTarget\":\"Resource\",\"showIcon\":true}},{\"columnMatch\":\"Name\",\"formatter\":5},{\"columnMatch\":\"subscriptionId\",\"formatter\":5}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"subscriptionId\"],\"expandTopLevel\":true,\"finalBy\":\"Name\"}}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"notag\"},\"name\":\"query - Untagged Resources\"},{\"type\":1,\"content\":{\"json\":\"## App Services:\\r\\n üí° _Click on a resource name to go to the resource in the portal, or click on a URL to go to the web app in your browser._\\r\\n\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"apps\"},\"name\":\"text - 124\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\" Resources\\r\\n | where type == 'microsoft.web/sites'\\r\\n | project [\\\"Web App\\\"] = id,\\r\\n   [\\\"App Service Plan\\\"] = tostring(properties.serverFarmId),\\r\\n   [\\\"Location\\\"] = location,\\r\\n   Kind = kind,\\r\\n   URL = strcat(\\\"https://\\\", properties.defaultHostName),\\r\\n   [\\\"SKU Name\\\"] = properties.sku\",\"size\":0,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"URL\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\"}}]}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"apps\"},\"name\":\"query - 125\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Sensitive Operations\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Sensitive Operations Report - RBAC Roles, Apps, Service Principals and Federation Settings\"},\"customWidth\":\"85\",\"name\":\"text - 2\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"00422c2b-b3bb-4bc1-b81a-54ab484f9a74\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Workspace\",\"type\":5,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"value\":[\"value::all\"],\"typeSettings\":{\"resourceTypeFilter\":{\"microsoft.operationalinsights/workspaces\":true},\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"15\",\"name\":\"parameters - 3\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"paragraph\",\"links\":[{\"id\":\"f02d3e95-c5e9-48ff-b4cf-3c1268b9ef5f\",\"cellValue\":\"https://aka.ms/SensitiveOperationsWorkbookDocs\",\"linkTarget\":\"Url\",\"linkLabel\":\"Learn more\",\"preText\":\"This workbook is intended to help identify suspicious application and service principal activity that may indicate compromises in your environment. \",\"postText\":\" about best practices to protect M365 from attacks.\",\"style\":\"link\"}]},\"name\":\"links - 7\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Modified application and service principal credentials/authentication methods\",\"expandable\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"# Modified Application and Service Principal Credentials/Authentication Methods\\r\\n\\r\\nApplications and service principals can have multiple authentication methods that are simultaneously valid. It's important to monitor updates to your service principal authentication methods in case bad actors are adding new rogue credentials to allow themselves to authenticate as that service principal.\"},\"name\":\"text - 1\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"41bb729a-1f00-463c-a600-ce6c15823f73\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":172800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000},\"timeContextFromParameter\":\"TimeRange\"},{\"id\":\"fbee76f5-de17-4d80-844b-b01d2613d996\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"OperationNameParam\",\"label\":\"Operation name\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"jsonData\":\"[\\r\\n    {\\\"value\\\": \\\"Add service principal credentials\\\", \\\"label\\\": \\\"Add service principal credentials\\\"},\\r\\n    {\\\"value\\\": \\\"Update application ‚Äì Certificates and secrets management \\\", \\\"label\\\": \\\"Update application ‚Äì Certificates and secrets management \\\"}\\r\\n]\",\"timeContext\":{\"durationMs\":2592000000}},{\"id\":\"87e2dbcd-6d21-430e-a1f4-470c3dcd3892\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"credential\",\"label\":\"Credential\",\"type\":2,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"query\":\"AuditLogs\\r\\n| where TimeGenerated {TimeRange:value}\\r\\n| where Category == \\\"ApplicationManagement\\\"\\r\\n| where \\\"{OperationNameParam}\\\" has OperationName\\r\\n| where OperationName != \\\"Add service principal\\\" and OperationName != \\\"Update application\\\"\\r\\n| mv-expand target = TargetResources\\r\\n| mv-expand modifiedProperty = target.modifiedProperties\\r\\n| extend newValue = tostring(modifiedProperty.newValue)\\r\\n| extend oldValue = tostring(modifiedProperty.oldValue)\\r\\n| extend set1 = parse_json(newValue)\\r\\n| extend set2 = parse_json(oldValue)\\r\\n| extend diff = set_difference(set1, set2)\\r\\n| where isnotempty(diff)\\r\\n| parse diff with * \\\"KeyIdentifier=\\\" keyIdentifier:string \\\",KeyType=\\\" keyType:string \\\",KeyUsage=\\\" keyUsage:string \\\",DisplayName=\\\" keyDisplayName:string \\\"]\\\" *\\r\\n| project credential = case(keyType != \\\"\\\", keyType, \\\"Other/not logged\\\")\\r\\n| summarize by credential\",\"crossComponentResources\":[\"{Workspace}\"],\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"timeContext\":{\"durationMs\":172800000},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},{\"id\":\"4d58037a-e6d3-4506-acd2-e8cb3fecf66d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Actor\",\"type\":1,\"value\":\"All\"},{\"id\":\"cdd0f13b-af82-48ec-b726-873f86f60365\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ExcludeActor\",\"label\":\"Exclude actor\",\"type\":1,\"value\":\"None\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AuditLogs\\r\\n| where TimeGenerated {TimeRange:value}\\r\\n| where Category == \\\"ApplicationManagement\\\"\\r\\n| where \\\"{OperationNameParam}\\\" has OperationName\\r\\n| where OperationName != \\\"Add service principal\\\" and OperationName != \\\"Update application\\\"\\r\\n| extend Actor = iff(isnotempty(InitiatedBy.user.userPrincipalName),tostring(InitiatedBy.user.userPrincipalName), tostring(InitiatedBy.app.displayName))\\r\\n| where Actor contains \\\"{Actor:escape}\\\" or \\\"{Actor:escape}\\\" == \\\"All\\\"\\r\\n| where Actor != \\\"{ExcludeActor:escape}\\\" or \\\"{ExcludeActor:escape}\\\" == \\\"None\\\"\\r\\n| mv-expand target = TargetResources\\r\\n| mv-expand modifiedProperty = target.modifiedProperties\\r\\n| extend newValue = tostring(modifiedProperty.newValue)\\r\\n| extend oldValue = tostring(modifiedProperty.oldValue)\\r\\n| extend set1 = parse_json(newValue)\\r\\n| extend set2 = parse_json(oldValue)\\r\\n| extend diff = set_difference(set1, set2)\\r\\n| where isnotempty(diff)\\r\\n| parse diff with * \\\"KeyIdentifier=\\\" keyIdentifier:string \\\",KeyType=\\\" keyType:string \\\",KeyUsage=\\\" keyUsage:string \\\",DisplayName=\\\" keyDisplayName:string \\\"]\\\" *\\r\\n| project TimeGenerated, OperationName, Actor = iff(isnotempty(InitiatedBy.user.userPrincipalName),tostring(InitiatedBy.user.userPrincipalName), tostring(InitiatedBy.app.displayName)), Actor_Type = case(isnotnull(InitiatedBy[\\\"user\\\"]), \\\"User\\\", \\\"App\\\"), Service_Principal_Name = tostring(target.displayName), credential = case(keyType != \\\"\\\", keyType, \\\"Other/not logged\\\"), Service_Principal_ID = target.id, Result\\r\\n| where \\\"{credential}\\\" has credential\\r\\n| summarize count() by Service_Principal_Name, credential\\r\\n| summarize count() by credential\\r\\n| sort by credential asc\",\"size\":4,\"title\":\"Number of application and service principals updated by authentication method ({TimeRange:label})\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"credential\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true}},\"name\":\"query - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AuditLogs\\r\\n| where TimeGenerated {TimeRange:value}\\r\\n| where Category == \\\"ApplicationManagement\\\"\\r\\n| where \\\"{OperationNameParam}\\\" has OperationName\\r\\n| where OperationName != \\\"Add service principal\\\" and OperationName != \\\"Update application\\\"\\r\\n| extend Actor = iff(isnotempty(InitiatedBy.user.userPrincipalName),tostring(InitiatedBy.user.userPrincipalName), tostring(InitiatedBy.app.displayName))\\r\\n| where Actor contains \\\"{Actor:escape}\\\" or \\\"{Actor:escape}\\\" == \\\"All\\\"\\r\\n| where Actor != \\\"{ExcludeActor:escape}\\\" or \\\"{ExcludeActor:escape}\\\" == \\\"None\\\"\\r\\n| mv-expand target = TargetResources\\r\\n| mv-expand modifiedProperty = target.modifiedProperties\\r\\n| extend newValue = tostring(modifiedProperty.newValue)\\r\\n| extend oldValue = tostring(modifiedProperty.oldValue)\\r\\n| extend set1 = parse_json(newValue)\\r\\n| extend set2 = parse_json(oldValue)\\r\\n| extend diff = set_difference(set1, set2)\\r\\n| where isnotempty(diff)\\r\\n| parse diff with * \\\"KeyIdentifier=\\\" keyIdentifier:string \\\",KeyType=\\\" keyType:string \\\",KeyUsage=\\\" keyUsage:string \\\",DisplayName=\\\" keyDisplayName:string \\\"]\\\" *\\r\\n| project TimeGenerated, OperationName, Actor = iff(isnotempty(InitiatedBy.user.userPrincipalName),tostring(InitiatedBy.user.userPrincipalName), tostring(InitiatedBy.app.displayName)), Actor_Type = case(isnotnull(InitiatedBy[\\\"user\\\"]), \\\"User\\\", \\\"App\\\"), Service_Principal_Name = tostring(target.displayName), credential = case(keyType != \\\"\\\", keyType, \\\"Other/not logged\\\"), Service_Principal_ID = target.id, Result\\r\\n| where \\\"{credential}\\\" has credential\\r\\n| summarize ServicePrincipalsChanged = dcount(Service_Principal_Name) by Actor, Actor_Type\\r\\n| sort by ServicePrincipalsChanged desc\",\"size\":1,\"title\":\"Top actors updating authentication methods ({TimeRange:label})\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"ServicePrincipalsChanged\",\"formatter\":8,\"formatOptions\":{\"palette\":\"red\"}}],\"filter\":true},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"modifiedProperty\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"count_\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}},\"showBorder\":true}},\"customWidth\":\"50\",\"name\":\"query - 3 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AuditLogs\\r\\n| where TimeGenerated {TimeRange:value}\\r\\n| where Category == \\\"ApplicationManagement\\\"\\r\\n| where \\\"{OperationNameParam}\\\" has OperationName\\r\\n| where OperationName != \\\"Add service principal\\\" and OperationName != \\\"Update application\\\"\\r\\n| extend Actor = iff(isnotempty(InitiatedBy.user.userPrincipalName),tostring(InitiatedBy.user.userPrincipalName), tostring(InitiatedBy.app.displayName))\\r\\n| where Actor contains \\\"{Actor:escape}\\\" or \\\"{Actor:escape}\\\" == \\\"All\\\"\\r\\n| where Actor != \\\"{ExcludeActor:escape}\\\" or \\\"{ExcludeActor:escape}\\\" == \\\"None\\\"\\r\\n| mv-expand target = TargetResources\\r\\n| mv-expand modifiedProperty = target.modifiedProperties\\r\\n| extend newValue = tostring(modifiedProperty.newValue)\\r\\n| extend oldValue = tostring(modifiedProperty.oldValue)\\r\\n| extend set1 = parse_json(newValue)\\r\\n| extend set2 = parse_json(oldValue)\\r\\n| extend diff = set_difference(set1, set2)\\r\\n| where isnotempty(diff)\\r\\n| parse diff with * \\\"KeyIdentifier=\\\" keyIdentifier:string \\\",KeyType=\\\" keyType:string \\\",KeyUsage=\\\" keyUsage:string \\\",DisplayName=\\\" keyDisplayName:string \\\"]\\\" *\\r\\n| project TimeGenerated, OperationName, Actor = iff(isnotempty(InitiatedBy.user.userPrincipalName),tostring(InitiatedBy.user.userPrincipalName), tostring(InitiatedBy.app.displayName)), Actor_Type = case(isnotnull(InitiatedBy[\\\"user\\\"]), \\\"User\\\", \\\"App\\\"), Service_Principal_Name = target.displayName, credential = case(keyType != \\\"\\\", keyType, \\\"Other/not logged\\\"), Service_Principal_ID = target.id, Result\\r\\n| where \\\"{credential}\\\" has credential\\r\\n| summarize count() by bin(TimeGenerated, 1d)\\r\\n| sort by TimeGenerated desc\",\"size\":1,\"title\":\"Updates to service principal authentication methods over time\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"visualization\":\"timechart\",\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0},\"chartSettings\":{\"xAxis\":\"TimeGenerated\",\"yAxis\":[\"count_\"],\"xSettings\":{\"numberFormatSettings\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"50\",\"name\":\"query - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AuditLogs\\r\\n| where TimeGenerated {TimeRange:value}\\r\\n| where Category == \\\"ApplicationManagement\\\"\\r\\n| where \\\"{OperationNameParam}\\\" has OperationName\\r\\n| where OperationName != \\\"Add service principal\\\" and OperationName != \\\"Update application\\\"\\r\\n| extend Actor = iff(isnotempty(InitiatedBy.user.userPrincipalName),tostring(InitiatedBy.user.userPrincipalName), tostring(InitiatedBy.app.displayName))\\r\\n| where Actor contains \\\"{Actor:escape}\\\" or \\\"{Actor:escape}\\\" == \\\"All\\\"\\r\\n| where Actor != \\\"{ExcludeActor:escape}\\\" or \\\"{ExcludeActor:escape}\\\" == \\\"None\\\"\\r\\n| mv-expand target = TargetResources\\r\\n| mv-expand modifiedProperty = target.modifiedProperties\\r\\n| extend newValue = tostring(modifiedProperty.newValue)\\r\\n| extend oldValue = tostring(modifiedProperty.oldValue)\\r\\n| extend set1 = parse_json(newValue)\\r\\n| extend set2 = parse_json(oldValue)\\r\\n| extend diff = set_difference(set1, set2)\\r\\n| where isnotempty(diff)\\r\\n| parse diff with * \\\"KeyIdentifier=\\\" keyIdentifier:string \\\",KeyType=\\\" keyType:string \\\",KeyUsage=\\\" keyUsage:string \\\",DisplayName=\\\" keyDisplayName:string \\\"]\\\" *\\r\\n| project TimeGenerated, OperationName, Actor = iff(isnotempty(InitiatedBy.user.userPrincipalName),tostring(InitiatedBy.user.userPrincipalName), tostring(InitiatedBy.app.displayName)), Actor_Type = case(isnotnull(InitiatedBy[\\\"user\\\"]), \\\"User\\\", \\\"App\\\"), Service_Principal_Name = target.displayName, credential = case(keyType != \\\"\\\", keyType, \\\"Other/not logged\\\"), Service_Principal_ID = target.id, Result\\r\\n| where \\\"{credential}\\\" has credential\\r\\n| sort by TimeGenerated desc\\r\\n\",\"size\":0,\"title\":\"Recent updates to application/service principal authentication methods\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"filter\":true}},\"name\":\"query - 0\"},{\"type\":1,\"content\":{\"json\":\"_____________________________________________\"},\"name\":\"text - 6\"}]},\"name\":\"Service principals\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"New permissions granted to service principals\",\"expandable\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"## New permissions granted to service principals\\r\\n\\r\\nThis section monitors for changes to OAuth 2.0 permissions granted to Service Principals. For example, this alert will trigger when a Service Principal is granted Application (AppOnly) permissions to read mail through the Microsoft Graph API. When this occurs, the Service Principal is added to an App Role with a value of Mail.Read. \\r\\n\\r\\nAn attacker could elevate their privileges by using a compromised account to grant new permissions to a Service Principal they control, or by tricking a user into granting permissions. Investigations should focus on high privilege permissions that either grant access to sensitive data, or represent opportunities for lateral movement by attackers.\\r\\n\\r\\nThe first view in this section focuses specifically on Application permissions, which generally (but not always) represent higher risk. The second view is broader- it includes Delegated (App+User) permissions grants and additional audit events.\"},\"name\":\"text - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"54c95e1f-b654-4f29-bf74-1f14812ed938\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":172800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"80d9f8f1-5928-44fc-8b50-b94f1fd4585a\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"ClientApp\",\"type\":1,\"value\":\"All\"},{\"id\":\"2cadd1cb-53b7-41bb-b81f-e5dfcfdd4176\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Resource\",\"type\":1,\"value\":\"All\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AuditLogs\\r\\n| where TimeGenerated {TimeRange:value}\\r\\n| where OperationName == \\\"Add app role assignment to service principal\\\"\\r\\n| project TimeGenerated, ClientApp = tostring(TargetResources[0].modifiedProperties[4].newValue), Resource = tostring(TargetResources[0].displayName), Role_Added = tostring(TargetResources[0].modifiedProperties[1].newValue), Explanation = tostring(TargetResources[0].modifiedProperties[2].newValue), InitiatingUserOrApp = iff(isnotempty(InitiatedBy.user.userPrincipalName),tostring(InitiatedBy.user.userPrincipalName), tostring(InitiatedBy.app.displayName))\\r\\n| where ClientApp contains \\\"{ClientApp:escape}\\\" or \\\"{ClientApp:escape}\\\" == \\\"All\\\"\\r\\n| where Resource contains \\\"{Resource:escape}\\\" or \\\"{Resource:escape}\\\" == \\\"All\\\"\\r\\n| summarize by ClientApp, Resource, Role_Added, Explanation, InitiatingUserOrApp, TimeGenerated\",\"size\":0,\"title\":\"New Application (AppOnly) permissions added to service principals\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Resource\",\"formatter\":5}],\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"Resource\",\"ClientApp\"],\"expandTopLevel\":true}}},\"name\":\"query - 5\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"cafff20d-feb7-4278-8fbf-3f93d4b422de\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":172800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"e1c39ee2-fff3-40be-9bd9-7135f3e8b46d\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Operation\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"jsonData\":\"[\\r\\n    {\\\"value\\\": \\\"Consent to application\\\", \\\"label\\\": \\\"Consent to application\\\"},\\r\\n    {\\\"value\\\": \\\"Add app role assignment to service principal\\\", \\\"label\\\": \\\"Add app role assignment to service principal\\\"},    \\r\\n    {\\\"value\\\": \\\"Add delegated permission grant\\\", \\\"label\\\": \\\"Add delegated permission grant\\\"}\\r\\n]\",\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"f899aaae-f278-4f5c-a665-9aba1ba92b9f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"InitiatingUserOrApp\",\"type\":1,\"value\":\"All\",\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AuditLogs\\r\\n| where TimeGenerated {TimeRange:value}\\r\\n| where \\\"{Operation}\\\" has OperationName\\r\\n| extend InitiatingUserOrApp = iff(isnotempty(InitiatedBy.user.userPrincipalName),tostring(InitiatedBy.user.userPrincipalName), tostring(InitiatedBy.app.displayName))\\r\\n| where InitiatingUserOrApp contains \\\"{InitiatingUserOrApp:escape}\\\" or \\\"{InitiatingUserOrApp:escape}\\\" == \\\"All\\\"\\r\\n| extend ClientApp = case(OperationName == \\\"Consent to application\\\", TargetResources[0].displayName, OperationName == \\\"Add app role assignment to service principal\\\", TargetResources[1].id, OperationName == \\\"Add delegated permission grant\\\", TargetResources[1].id, \\\"Not logged\\\")\\r\\n| extend Resource = case(OperationName == \\\"Consent to application\\\", \\\"Not logged\\\", OperationName == \\\"Add app role assignment to service principal\\\", TargetResources[0].displayName, OperationName == \\\"Add delegated permission grant\\\", TargetResources[0].displayName, \\\"Not logged\\\")\\r\\n| project TimeGenerated, InitiatingUserOrApp, OperationName, ClientApp, Resource, Result\\r\\n| sort by TimeGenerated desc\\r\\n\",\"size\":0,\"title\":\"Recent app permissions activity\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"Recent app permissions activity\"},{\"type\":1,\"content\":{\"json\":\"________________________________________________\"},\"name\":\"text - 5\"}]},\"name\":\"Permissions\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Directory role and group membership updates to service principals\",\"expandable\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"## Directory role and group membership updates to service principals\\r\\n\\r\\nThis section monitors for Service Principals being as members of Directory Roles (admin roles) or Groups. For example, this alert will trigger when a Service Principal is added to the Company Administrator or Application Administrator role. \\r\\n \\r\\nAn attacker could elevate their privileges by adding a Service Principal they control to a high privileged role or a group that is used to protect access to sensitive resources. Investigations should focus on administrator rules and Groups that either grant access to sensitive data or represent opportunities for lateral movement by attackers.\\r\\n\"},\"name\":\"text - 0\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"3baa6f39-71c9-4f06-a58c-465104de8a16\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":172800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"e7a8c646-6800-40c4-9c21-445384a6a5bc\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Operation\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"value\":[\"Add member to role\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"jsonData\":\"[\\r\\n    {\\\"value\\\": \\\"Add member to role\\\", \\\"label\\\": \\\"Add member to role\\\"},\\r\\n    {\\\"value\\\": \\\"Add eligible member to role\\\", \\\"label\\\": \\\"Add eligible member to role\\\"},\\r\\n    {\\\"value\\\": \\\"Add scoped member to role\\\", \\\"label\\\": \\\"Add scoped member to role\\\"},\\r\\n    {\\\"value\\\": \\\"Add member to group\\\", \\\"label\\\": \\\"Add member to group\\\"}\\r\\n]\",\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"16bfa3f9-044a-4c17-b5a4-4116acc7a725\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"InitiatingUserOrApp\",\"type\":1,\"value\":\"All\",\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AuditLogs\\r\\n| where TimeGenerated {TimeRange:value}\\r\\n| extend InitiatingUserOrApp = iff(isnotempty(InitiatedBy.user.userPrincipalName),tostring(InitiatedBy.user.userPrincipalName), tostring(InitiatedBy.app.displayName))\\r\\n| where InitiatingUserOrApp contains \\\"{InitiatingUserOrApp:escape}\\\" or \\\"{InitiatingUserOrApp:escape}\\\" == \\\"All\\\"\\r\\n| extend type = tostring(TargetResources[0].type)\\r\\n| where type == \\\"ServicePrincipal\\\"\\r\\n| where \\\"{Operation}\\\" has OperationName \\r\\n| project TimeGenerated, InitiatingUserOrApp, OperationName, ServicePrincipalDisplayName = TargetResources[0].displayName, GroupOrRoleNameAddedTo = TargetResources[0].modifiedProperties[1].newValue\\r\\n\",\"size\":0,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"],\"sortBy\":[]},\"name\":\"query - 1\"}]},\"name\":\"group - 6\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Modified federation settings \",\"expandable\":true,\"items\":[{\"type\":1,\"content\":{\"json\":\"# Modified federation settings\\r\\n\\r\\nThis section monitors when a user or application modifies the federation settings on the domain. For example, this alert will trigger when a new Active Directory Federated Service (ADFS) TrustedRealm object, such as a signing certificate, is added to the domain. Modification to domain federation settings should be rare. Confirm the added or modified target domain/URL is legitimate administrator behavior.\\r\\n- To understand why an authorized user may update settings for a federated domain in Office 365, Azure, or Intune, see: https://docs.microsoft.com/office365/troubleshoot/active-directory/update-federated-domain-office-365.\\r\\n- For details on security realms that accept security tokens, see the ADFS Proxy Protocol (MS-ADFSPP) specification: https://docs.microsoft.com/openspecs/windows_protocols/ms-adfspp/e7b9ea73-1980-4318-96a6-da559486664b.\"},\"name\":\"text - 2\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"b448e249-c85d-43d0-ba64-c552a62baad4\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":172800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":172800000},{\"durationMs\":604800000},{\"durationMs\":1209600000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"2529872f-38b3-4409-b511-ceb5258fc338\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"Operation\",\"type\":2,\"isRequired\":true,\"multiSelect\":true,\"quote\":\"'\",\"delimiter\":\",\",\"value\":[\"value::all\"],\"typeSettings\":{\"additionalResourceOptions\":[\"value::all\"],\"showDefault\":false},\"jsonData\":\"[\\r\\n    {\\\"value\\\": \\\"Set domain authentication\\\", \\\"label\\\": \\\"Set domain authentication\\\"},\\r\\n    {\\\"value\\\": \\\"Set federation settings on domain\\\", \\\"label\\\": \\\"Set federation settings on domain\\\"},\\r\\n    {\\\"value\\\": \\\"Add unverified domain\\\", \\\"label\\\": \\\"Add unverified domain\\\"},\\r\\n    {\\\"value\\\": \\\"Add verified domain\\\", \\\"label\\\": \\\"Add verified domain\\\"},\\r\\n    {\\\"value\\\": \\\"Verify domain\\\", \\\"label\\\": \\\"Verify domain\\\"}\\r\\n]\",\"timeContext\":{\"durationMs\":86400000}},{\"id\":\"86b52c65-055d-4a6a-a52f-b1d69e1f3c0f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"InitiatingUserOrApp\",\"type\":1,\"value\":\"All\",\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"  AuditLogs\\r\\n  | where TimeGenerated {TimeRange:value}\\r\\n  | where \\\"{Operation}\\\" has OperationName\\r\\n  //| where Result =~ \\\"success\\\"   // commenting out, as it may be interesting to capture failed attempts\\r\\n  | extend targetDisplayName = tostring(TargetResources[0].displayName)\\r\\n  | extend UserAgent = iff(AdditionalDetails[0].key == \\\"User-Agent\\\",tostring(AdditionalDetails[0].value),\\\"\\\")\\r\\n  | extend InitiatingUserOrApp = iff(isnotempty(InitiatedBy.user.userPrincipalName),tostring(InitiatedBy.user.userPrincipalName), tostring(InitiatedBy.app.displayName))\\r\\n  | where InitiatingUserOrApp contains \\\"{InitiatingUserOrApp:escape}\\\" or \\\"{InitiatingUserOrApp:escape}\\\" == \\\"All\\\"\\r\\n  | project-reorder TimeGenerated, OperationName, InitiatingUserOrApp, AADOperationType, targetDisplayName, TargetResources, Result, UserAgent, CorrelationId, TenantId, AADTenantId\\r\\n  | sort by TimeGenerated desc\\r\\n\",\"size\":0,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"{Workspace}\"]},\"name\":\"query - 0\"},{\"type\":1,\"content\":{\"json\":\"________________________\"},\"name\":\"text - 7\"}]},\"name\":\"Federation\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Modified RBAC Role Assignments\",\"expandable\":true,\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let substring = \\\"@luckcompanies.com\\\";\\r\\nAzureActivity\\r\\n| where Caller has '@luckcompanies'\\r\\n| project-rename Date = TimeGenerated, User = Caller, Operation = OperationNameValue, Resource_Group = ResourceGroup,Role = Authorization_d, jsonProperties = Properties_d\\r\\n| where tostring(Role.evidence.role) has ''\\r\\n| summarize by User, Operation, Resource_Group, tostring(Role.evidence.role)\\r\\n\",\"size\":0,\"title\":\"User Modified Resources with RBAC Assignment\",\"timeContext\":{\"durationMs\":86400000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"crossComponentResources\":[\"/subscriptions/03648514-5be8-4be8-ba64-cfaa241b2448/resourceGroups/Azure-Sentinel-RG/providers/Microsoft.OperationalInsights/workspaces/LuckAzureSentinel\"],\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0}},\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"AzureActivity\\r\\n| where Authorization contains \\\"Microsoft.Authorization/roleAssignments\\\"\\r\\n| where OperationNameValue has 'Microsoft.Authorization/roleAssignments/write'\\r\\n| where ActivityStatus has 'Succeeded'\\r\\n| extend RoleAssignmentName = split(todynamic(Properties).entity, '/')[-1]\\r\\n| project EventSubmissionTimestamp, Caller, OperationName, ResourceGroup, ResourceId, RoleAssignmentName\\r\\n\\r\\n\",\"size\":1,\"showAnalytics\":true,\"title\":\"RBAC Role Assignments\",\"timeContext\":{\"durationMs\":604800000},\"queryType\":0,\"resourceType\":\"microsoft.resources/subscriptions\",\"crossComponentResources\":[\"/subscriptions/cf0147cc-579f-4301-b670-e6da516ed220\",\"/subscriptions/bde5bb61-3af0-41c4-a5d0-425cbc0b4c34\",\"/subscriptions/8696a879-3096-4453-b08b-324d908c0828\",\"/subscriptions/41100773-22b2-475b-9530-b1d730d3bfc1\",\"/subscriptions/14682249-fbed-42e5-84e7-4022fb1e7968\",\"/subscriptions/03648514-5be8-4be8-ba64-cfaa241b2448\"]},\"name\":\"query - 1\"}]},\"name\":\"group - 7\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"sensitiveops\"},\"name\":\"group - 127\"},{\"type\":1,\"content\":{\"json\":\"## Change Analysis\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"changes\"},\"name\":\"text - 128\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"dde59acf-e5c3-4277-a7e8-bb563e634dcd\",\"cellValue\":\"changeTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Recent Changes\",\"subTarget\":\"chng\",\"preText\":\"APP Services\",\"style\":\"link\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"changes\"},\"name\":\"links - 129\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"// Resource Changes Last 24 hours\\r\\n// My shared query\\r\\n// Click the \\\"Run query\\\" command above to execute the query and see results.\\r\\nresourcechanges\\r\\n|¬†extend¬†changeTime¬†=¬†todatetime(properties.changeAttributes.timestamp),¬†targetResourceId¬†=¬†tostring(properties.targetResourceId),\\r\\nchangeType¬†=¬†tostring(properties.changeType),¬†correlationId¬†=¬†properties.changeAttributes.correlationId,¬†\\r\\nchangedProperties¬†=¬†properties.changes,¬†changeCount¬†=¬†properties.changeAttributes.changesCount\\r\\n| extend resourceName = tostring(split(targetResourceId, '/')[-1])\\r\\n| extend resourceType = tostring(split(targetResourceId, '/')[-2])\\r\\n|¬†where¬†changeTime¬†>¬†ago(24h)\\r\\n|¬†order¬†by¬†changeTime¬†desc\\r\\n|¬†project¬†changeTime,¬†resourceName, resourceType, targetResourceId,¬†changeType,¬†changeCount,¬†changedProperties\",\"size\":0,\"showAnalytics\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"{Subscriptions}\"],\"gridSettings\":{\"labelSettings\":[{\"columnId\":\"changeTime\",\"label\":\"Change Time\"},{\"columnId\":\"resourceName\",\"label\":\"Resource Name\"},{\"columnId\":\"resourceType\",\"label\":\"Resource Type\"},{\"columnId\":\"targetResourceId\",\"label\":\"Link to Resource\"},{\"columnId\":\"changeType\",\"label\":\"Change Type\"},{\"columnId\":\"changeCount\",\"label\":\"Number of Changes\"},{\"columnId\":\"changedProperties\",\"label\":\"Changed Properties\"}]}},\"conditionalVisibilities\":[{\"parameterName\":\"changeTab\",\"comparison\":\"isEqualTo\",\"value\":\"chng\"},{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"changes\"}],\"name\":\"query - 130\"},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"Oprhaned Resources\",\"items\":[{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"id\":\"cfc02e91-b6fc-4a11-92f7-02e22a186233\",\"cellValue\":\"orphanTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Disks\",\"subTarget\":\"disks\",\"preText\":\"Disks\",\"style\":\"link\"},{\"id\":\"190355db-3f4e-49a7-a8cf-743ca69600dd\",\"cellValue\":\"orphanTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"NICs\",\"subTarget\":\"nics\",\"style\":\"link\"},{\"id\":\"512384f5-2fe9-4920-be04-deb9e68ae0ec\",\"cellValue\":\"orphanTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Public IPs\",\"subTarget\":\"pips\",\"style\":\"link\"},{\"id\":\"36112de9-bc46-4a39-85c2-4c76f6b31a99\",\"cellValue\":\"orphanTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"NSGs\",\"subTarget\":\"nsgs\",\"style\":\"link\"},{\"id\":\"f5451904-a244-4240-bcef-0d8e5f249c33\",\"cellValue\":\"orphanTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Web Apps\",\"subTarget\":\"wapps\",\"style\":\"link\"}]},\"name\":\"links - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Resources\\r\\n| where type has \\\"microsoft.compute/disks\\\"\\r\\n| extend diskState = tostring(properties.diskState)\\r\\n| where managedBy == \\\"\\\" and diskState != 'ActiveSAS'\\r\\nor diskState == 'Unattached' and diskState != 'ActiveSAS'\\r\\n| project id, diskState, resourceGroup, location, subscriptionId\",\"size\":0,\"title\":\"Disks\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"]},\"conditionalVisibility\":{\"parameterName\":\"orphanTab\",\"comparison\":\"isEqualTo\",\"value\":\"disks\"},\"name\":\"query - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type =~ \\\"microsoft.network/networkinterfaces\\\"\\r\\n| join kind=leftouter (resources\\r\\n| where type =~ 'microsoft.network/privateendpoints'\\r\\n| extend nic = todynamic(properties.networkInterfaces)\\r\\n| mv-expand nic\\r\\n| project id=tostring(nic.id) ) on id\\r\\n| where isempty(id1)\\r\\n| where properties !has 'virtualmachine'\\r\\n| project id, resourceGroup, location, subscriptionId\",\"size\":0,\"title\":\"NICs\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"]},\"conditionalVisibility\":{\"parameterName\":\"orphanTab\",\"comparison\":\"isEqualTo\",\"value\":\"nics\"},\"name\":\"query - 2\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type =~ 'microsoft.network/publicipaddresses'\\r\\n| extend IpConfig = properties.ipConfiguration.id\\r\\n| where isempty(IpConfig)\",\"size\":0,\"title\":\"Public IPs\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"]},\"conditionalVisibility\":{\"parameterName\":\"orphanTab\",\"comparison\":\"isEqualTo\",\"value\":\"pips\"},\"name\":\"query - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"Resources\\r\\n| where type =~ 'microsoft.network/networksecuritygroups' and isnull(properties.networkInterfaces) and isnull(properties.subnets)\\r\\n| project Resource=id, resourceGroup, subscriptionId, location\",\"size\":1,\"title\":\"NSGs\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"]},\"conditionalVisibility\":{\"parameterName\":\"orphanTab\",\"comparison\":\"isEqualTo\",\"value\":\"nsgs\"},\"name\":\"query - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"resources\\r\\n| where type =~ 'Microsoft.Web/connections'\\r\\n| extend GatewayName=iff(isnotempty(todynamic(properties)[\\\"parameterValues\\\"]),todynamic(properties)[\\\"parameterValues\\\"][\\\"gateway\\\"][\\\"name\\\"] ,todynamic(properties)[\\\"parameterValueSet\\\"][\\\"values\\\"][\\\"gateway\\\"][\\\"value\\\"][\\\"name\\\"])\\r\\n|project API_id=id ,API_Name=name,GatewayName,API_resourceGroup=resourceGroup\\r\\n|join kind= leftouter\\r\\n(\\r\\nresources\\r\\n| where type == 'microsoft.logic/workflows'\\r\\n|extend propertiesJson=parse_json(properties)\\r\\n|extend ConJson=propertiesJson[\\\"parameters\\\"][\\\"$connections\\\"][\\\"value\\\"]\\r\\n|mvexpand Conn=ConJson\\r\\n|where   notnull(Conn)\\r\\n|extend connectionId=extract(\\\"\\\\\\\"connectionId\\\\\\\":\\\\\\\"(.*?)\\\\\\\"\\\",1,tostring(Conn))\\r\\n|project connectionId,LogicApp_id=id,LogicApp_resourceGroup=resourceGroup,LogicApp_Name=name\\r\\n)   on  $left.API_id==$right.connectionId\\r\\n|project API_Name ,API_resourceGroup,GatewayName,Used_in_LogicApp =iff(isnotempty(LogicApp_id), \\\"Yes\\\",\\\"No\\\")  \\r\\n| where Used_in_LogicApp has \\\"No\\\"\",\"size\":0,\"title\":\"Web Apps\",\"showExportToExcel\":true,\"queryType\":1,\"resourceType\":\"microsoft.resourcegraph/resources\",\"crossComponentResources\":[\"value::all\"]},\"conditionalVisibility\":{\"parameterName\":\"orphanTab\",\"comparison\":\"isEqualTo\",\"value\":\"wapps\"},\"name\":\"query - 5\"}]},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"orphans\"},\"name\":\"group - 132\"}],\"isLocked\":false,\"fallbackResourceIds\":[\"azure monitor\"]}",
        "version": "1.0",
        "sourceId": "[parameters('workbookSourceId')]",
        "category": "[parameters('workbookType')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "value": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookId'))]"
    }
  },
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"
}